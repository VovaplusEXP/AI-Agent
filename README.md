# 🤖 AI Agent - ReAct агент с автономным рассуждением

[![Version](https://img.shields.io/badge/version-0.0.3--p1--alpha-blue.svg)](CHANGELOG.md)
[![Status](https://img.shields.io/badge/status-alpha-yellow.svg)](ROADMAP.md)
[![Python](https://img.shields.io/badge/python-3.11+-green.svg)](https://python.org)
[![License](https://img.shields.io/badge/license-AGPL--3.0-blue.svg)](LICENSE)

**Автономный AI-агент на базе Gemma-3n-E4B** с поддержкой ReAct цикла (Reason → Action → Observation), долговременной памятью и адаптивным управлением контекстом.

> **⚠️ Alpha версия:** Проект находится в активной разработке. Основной функционал работает, но возможны изменения API и поведения. См. [ROADMAP.md](ROADMAP.md) для планов развития.

## 📖 Документация

- **[CHANGELOG.md](CHANGELOG.md)** - История изменений
- **[ROADMAP.md](ROADMAP.md)** - Планы развития
- **[CLI_README.md](CLI_README.md)** - Документация по CLI
- **[ALPHA_RELEASE.md](ALPHA_RELEASE.md)** - Анонс релиза Alpha v0.0.2
- **[doc/](doc/)** - Техническая документация
  - [DOCUMENTATION.md](doc/DOCUMENTATION.md) - Детальная документация
  - [MASTER_DOCUMENTATION.md](doc/MASTER_DOCUMENTATION.md) - Полная документация (включая поддержку изображений и PDF)
  - [PATCH_v3.3.1_SUMMARY.md](doc/PATCH_v3.3.1_SUMMARY.md) - Последний патч
  - [PATCH_v3.3.1_TEST_RESULTS.md](doc/PATCH_v3.3.1_TEST_RESULTS.md) - Результаты тестов

---

## 🎯 Что это?

**AI Agent** - это автономная система, которая может:

- 🧠 **Рассуждать** о задачах и планировать решения
- 🔧 **Выполнять действия** через набор из 19 инструментов
- 💾 **Запоминать** контекст и важные факты (3-уровневая память)
- 📊 **Анализировать** код, файлы, веб-страницы
- 🖼️ **Обрабатывать** изображения и PDF документы (оптимизация токенов)
- 🔄 **Адаптироваться** к размеру контекста (интеллектуальное сжатие)
- 🌐 **Искать** информацию в интернете и обрабатывать её

---

## ✨ Основные возможности (v0.0.2-alpha)

### 🎯 ReAct цикл
- **Автономное рассуждение:** Thought → Action → Observation
- **Флаговый формат:** 100% успешность парсинга (без JSON escaping)
- **50 циклов на задачу:** Достаточно для сложных многошаговых задач
- **Self-reflection:** Автоматический анализ ошибок и их исправление

### 💾 Трёхуровневая память
- **L1 (Scratchpad):** Текущая цель, план, последний результат
- **L2 (История):** Интеллектуальное сжатие (80-85% экономии)
- **L3 (Векторная):** FAISS + SentenceTransformer
  - Глобальная память (shared)
  - Проектная память (per-chat)

### 🧠 Интеллектуальное сжатие
- **LLM-based:** Сжатие длинных результатов через LLM
- **Извлечение фактов:** URLs, файлы, версии, технологии
- **Блоковое сжатие:** При переполнении сжимается конкретный блок, не вся сессия
- **Оптимизация изображений:** 85% экономии токенов (512x512, ~65 токенов/изображение)
- **Автоматическое:** Срабатывает при >80% утилизации контекста
- **Невидимое:** Пользователь не замечает процесс

### 🔧 19 инструментов
- **Файлы:** read (с поддержкой изображений и PDF), write, create, edit, replace, list
- **Анализ:** analyze_code
- **Shell:** run_shell_command
- **Веб:** internet_search, web_fetch, web_search_in_page, web_get_structure
- **Память:** list, add, delete
- **Завершение:** finish

### 🛡️ Защита от зацикливания
- **Валидация дубликатов:** Блокирует повторные web_fetch/internet_search
- **Явный паттерн:** internet_search → web_fetch → web_search_in_page → create_file
- **Умные подсказки:** Агент получает инструкции при попытке дубликата

### 🚀 Производительность
- **Контекст:** 24k токенов (n_ctx=24576)
- **GPU:** Полная поддержка (RTX 4060: ~72% VRAM)
- **Утилизация:** 95% GPU (стабильно)
- **Скорость:** ~7-10 секунд на цикл

### 🎨 CLI (v0.0.3-p1-alpha)
- **Статус в реальном времени:** Мониторинг контекста и памяти
- **Визуальное оформление:** Панели, градиенты, иконки (вдохновлено gemini-cli)
- **Предпросмотр кода:** Подсветка синтаксиса перед записью
- **Markdown рендеринг:** Улучшенное отображение с Rich
- **Цветовые индикаторы:** Зеленый/желтый/красный для состояния
- **Статистика инструментов:** Отслеживание вызовов и производительности
- **Анимированные spinners:** Визуальная обратная связь при работе
- **Русский язык:** Полная локализация интерфейса
- **Подробнее:** См. [CLI_README.md](CLI_README.md)

---

## 📊 Тестирование (v3.3.1)

**Запрос:** "Найди информацию о Python 3.13"

**Результаты:**
- ✅ **13 циклов** выполнения
- ✅ **0 дубликатов** (валидация работает!)
- ✅ **3 компрессии** истории
- ✅ **100% корректный паттерн:**
  ```
  internet_search → web_fetch → web_search_in_page → create_file
  ```
- ✅ Файл `python_3.13_info.md` создан успешно
- ✅ **GPU:** 95% утилизация, стабильно
- ✅ **VRAM:** 72% (5566 MB), headroom 2.6GB

📄 См. [doc/PATCH_v3.3.1_TEST_RESULTS.md](doc/PATCH_v3.3.1_TEST_RESULTS.md) для полного отчёта.

---

## 🚀 Быстрый старт

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Запуск агента

```bash
python cli.py
```

**CLI включает:**
- 📊 Статус-панель в реальном времени (контекст & память)
- 🎨 Улучшенный визуальный дизайн
- 📝 Предпросмотр кода перед записью
- 🔍 Подсветка синтаксиса
- 🇷🇺 Полная поддержка русского языка

> **Примечание:** См. [CLI_README.md](CLI_README.md) для подробностей.

### 3. Первая задача

```
👤 Введите задачу: Создай файл hello.py с функцией приветствия

🤖 Агент:
<THOUGHT>
Создам простой Python файл с функцией для приветствия
<TOOL>
write_file
<PARAMS>
{"file_path": "hello.py"}
<CONTENT>
def greet(name):
    print(f"Привет, {name}!")

if __name__ == "__main__":
    greet("Мир")
<END>

✅ Файл hello.py создан!
```

---

## 🛠️ Технологии

- **LLM:** Gemma-3n-E4B (IQ4_XS, 32K context, мультимодальная)
- **Фреймворк:** llama-cpp-python
- **Память:** FAISS (vector search)
- **Эмбеддинги:** all-MiniLM-L6-v2 (Sentence Transformers)
- **Python:** 3.11+

---

## 🏗️ Архитектура

```
┌─────────────────────────────────────────────────┐
│              User Input (Задача)                │
└────────────────────┬────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────┐
│          ReAct Cycle (Agent.run_cycle)          │
│  ┌─────────────────────────────────────────┐   │
│  │  1. REASON (думаю, планирую)            │   │
│  │  2. ACTION (выбираю инструмент)         │   │
│  │  3. OBSERVATION (получаю результат)     │   │
│  └─────────────────────────────────────────┘   │
└────────────────────┬────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────┐
│         Parser v3.0.0 (Флаговый формат)         │
│  ┌──────────────────┐   ┌──────────────────┐   │
│  │  Флаги <THOUGHT> │ → │  JSON (fallback) │   │
│  │  <TOOL><PARAMS>  │   │                  │   │
│  │  <CONTENT><END>  │   │                  │   │
│  └──────────────────┘   └──────────────────┘   │
└────────────────────┬────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────┐
│              Tool Execution                      │
│  ┌─────────────────────────────────────────┐   │
│  │  15+ инструментов (файлы, код, web...)  │   │
│  └─────────────────────────────────────────┘   │
└────────────────────┬────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────┐
│        Memory & Context Management               │
│  ┌────────────┐  ┌──────────────────────────┐  │
│  │ L1: Рабочая│  │  Adaptive Context Mgr    │  │
│  │ L2: FAISS  │→ │  (20K tokens, приоритеты)│  │
│  │ L3: Global │  └──────────────────────────┘  │
│  └────────────┘                                 │
└─────────────────────────────────────────────────┘
```

📖 [Детальная архитектура](doc/MASTER_DOCUMENTATION.md#архитектура)

---

## 📊 Версионирование

Проект использует [Semantic Versioning](https://semver.org/):
- **MAJOR.MINOR.PATCH-stage**
- **Stage:** `alpha` → `beta` → `rc` → `stable`

### Текущий этап: Alpha (v0.0.2)
- ✅ Основной функционал работает
- ✅ Поддержка изображений и PDF
- ⚠️ Возможны breaking changes
- 🔬 Экспериментальные фичи

### Планы:
- **Beta (v0.x.0):** Стабилизация, Web UI, новые инструменты
- **RC (v1.0.0-rc.x):** Подготовка к релизу, финальное тестирование
- **Stable (v1.0.0+):** Production-ready, обратная совместимость

📄 См. [ROADMAP.md](ROADMAP.md) для детальных планов развития.

---

## 🤝 Вклад в проект

Приветствуются:
- 🐛 **Баг-репорты** - нашли проблему? Создайте issue
- ✨ **Идеи новых функций** - предложите улучшения
- 📝 **Улучшение документации** - опечатки, неясности, примеры
- 🔧 **Pull requests** - новые инструменты, фиксы, тесты

**Как начать:**
1. Fork репозитория
2. Создайте ветку для вашей фичи (`git checkout -b feature/amazing-feature`)
3. Commit изменения (`git commit -m 'Add amazing feature'`)
4. Push в ветку (`git push origin feature/amazing-feature`)
5. Создайте Pull Request

---

## 📝 Лицензия

**Код проекта:** GNU Affero General Public License v3.0 (AGPL-3.0) - см. [LICENSE](LICENSE)

**Модель Gemma:** [Gemma Terms of Use](https://www.kaggle.com/models/google/gemma/license/consent) (Google)

> **📌 Примечание:** AGPL-3.0 требует открытия исходного кода при использовании в сетевых сервисах. Это гарантирует, что улучшения проекта останутся открытыми. Если вам нужна коммерческая лицензия, свяжитесь с автором.

---

## 🙏 Благодарности

- **Google** - [Gemma](https://ai.google.dev/gemma) модели
- **[llama-cpp-python](https://github.com/abetlen/llama-cpp-python)** - отличная производительность и стабильность
- **[FAISS](https://github.com/facebookresearch/faiss)** (Meta) - быстрый векторный поиск
- **[SentenceTransformers](https://www.sbert.net/)** - эффективные эмбеддинги
- **[HuggingFace](https://huggingface.co/)** - экосистема и инструменты

---

<div align="center">

**Создано с ❤️ для автономного AI**

[Документация](doc/DOCUMENTATION.md) • [Changelog](CHANGELOG.md) • [Roadmap](ROADMAP.md)

**v0.0.3-p1-alpha** | 2025-10-18

</div>
