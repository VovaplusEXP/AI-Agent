# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ PDF –≤ AI Agent

## –û–±–∑–æ—Ä

–ê–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á—Ç–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ PDF-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `read_file`. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–∫–µ–Ω–æ–≤ –±–µ–∑ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞.

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ß—Ç–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `read_file` —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
- JPEG (.jpg, .jpeg)
- PNG (.png)
- GIF (.gif)
- BMP (.bmp)
- TIFF (.tiff, .tif)
- WebP (.webp)

#### –ü—Ä–æ—Ü–µ—Å—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

1. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞**: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è –¥–æ 512x512 –ø–∏–∫—Å–µ–ª–µ–π —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–π
2. **–°–∂–∞—Ç–∏–µ**: JPEG —Å–∂–∞—Ç–∏–µ —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 85 –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º –∏ —Ä–∞–∑–º–µ—Ä–æ–º
3. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞**: –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ RGB JPEG
4. **–ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ**: Base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ LLM

#### –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤

- **–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 2048x1536 ‚Üí ~318 —Ç–æ–∫–µ–Ω–æ–≤
- **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 512x512 ‚Üí ~65 —Ç–æ–∫–µ–Ω–æ–≤
- **–≠–∫–æ–Ω–æ–º–∏—è**: ~85% –º–µ–Ω—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
# –ß—Ç–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
result = read_file("path/to/image.jpg")
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
# üì∑ –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï: image.jpg
# –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 13.17 –ö–ë
# –§–æ—Ä–º–∞—Ç: JPG
# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
# 
# [IMAGE_DATA:base64_encoded_data...]
```

### 2. –ß—Ç–µ–Ω–∏–µ PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ –Ω–∞–±–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É).

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF

1. **–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü**: –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º 150 DPI
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ö–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (512x512, quality=85)
3. **–õ–∏–º–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü**: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–µ 10 —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞
4. **–ù—É–º–µ—Ä–∞—Ü–∏—è**: –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `[PAGE_N_IMAGE_DATA:...]`

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
# –ß—Ç–µ–Ω–∏–µ PDF
result = read_file("path/to/document.pdf")
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
# üìÑ PDF –î–û–ö–£–ú–ï–ù–¢: document.pdf
# –°—Ç—Ä–∞–Ω–∏—Ü –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 3
# –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
# 
# [PAGE_1_IMAGE_DATA:base64_data...]
# [PAGE_2_IMAGE_DATA:base64_data...]
# [PAGE_3_IMAGE_DATA:base64_data...]
```

### 3. –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–∂–∞—Ç–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤.

#### –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ (–ø—Ä–æ–±–ª–µ–º–∞)
–ü—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ –≤—Å—è —Å–µ—Å—Å–∏—è –¥—Ä–æ–ø–∞–ª–∞—Å—å –∏–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –≥—Ä—É–±–æ –æ–±—Ä–µ–∑–∞–ª–∞—Å—å.

#### –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (—Ä–µ—à–µ–Ω–∏–µ)
–í–º–µ—Å—Ç–æ –¥—Ä–æ–ø–∞ —Å–µ—Å—Å–∏–∏, —Å–∂–∏–º–∞–µ—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—â–∏–π –±–ª–æ–∫:

1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è**: –ö–æ–≥–¥–∞ –Ω–æ–≤—ã–π –±–ª–æ–∫ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–π –±—é–¥–∂–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤
2. **–°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ–µ —Å–∂–∞—Ç–∏–µ**: –°–∂–∏–º–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–ª–æ–∫
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: –û—Å—Ç–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç–æ–π
4. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è**: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (system prompt, scratchpad) –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–∂–∏–º–∞—é—Ç—Å—è

#### –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–∂–∞—Ç–∏—è –±–ª–æ–∫–∞

```python
def compress_block_on_overflow(block_content, llm, max_tokens, preserve_images=True):
    """
    –°–∂–∏–º–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—â–∏–π –±–ª–æ–∫ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤:
    
    1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
       - –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –µ—Å–ª–∏ preserve_images=True
       - –£–¥–∞–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º
    
    2. –°–∂–∞—Ç–∏–µ —Ç–µ–∫—Å—Ç–∞:
       - –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç > max_tokens * 4 —Å–∏–º–≤–æ–ª–æ–≤
       - –ò—Å–ø–æ–ª—å–∑—É–µ–º LLM –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
    
    3. –°–±–æ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
       - –°–∂–∞—Ç—ã–π —Ç–µ–∫—Å—Ç + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    """
```

#### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

**–î–æ —Å–∂–∞—Ç–∏—è** (–ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ):
```
Observation: Very long text... (2800 —Å–∏–º–≤–æ–ª–æ–≤)
[IMAGE_DATA:img1]
[IMAGE_DATA:img2]
[IMAGE_DATA:img3]
[IMAGE_DATA:img4]
–ò—Ç–æ–≥–æ: ~400 —Ç–æ–∫–µ–Ω–æ–≤, –ª–∏–º–∏—Ç: 200 —Ç–æ–∫–µ–Ω–æ–≤
```

**–ü–æ—Å–ª–µ —Å–∂–∞—Ç–∏—è**:
```
Observation (—Å–∂–∞—Ç–æ): –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤...
[IMAGE_DATA:img1]
[IMAGE_DATA:img2]
[–£–¥–∞–ª–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤: 2]
–ò—Ç–æ–≥–æ: ~180 —Ç–æ–∫–µ–Ω–æ–≤, —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –ª–∏–º–∏—Ç
```

### 4. –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤

–§—É–Ω–∫—Ü–∏—è `count_tokens` –≤ `ContextManager` —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:

```python
def count_tokens(text: str) -> int:
    """
    –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã —Å —É—á–µ—Ç–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
    
    1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ [IMAGE_DATA:...] –∏ [PAGE_N_IMAGE_DATA:...]
    2. –£–¥–∞–ª—è–µ—Ç –∏—Ö –∏–∑ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
    3. –î–æ–±–∞–≤–ª—è–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (~65 —Ç–æ–∫–µ–Ω–æ–≤)
    4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É–º–º–∞—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤
    """
```

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ compression.py

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏:

- `compress_block_on_overflow()` - –°–∂–∞—Ç–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–ª–æ–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏
- `_compress_images_in_message()` - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω `compress_history_smart()` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∂–∏–º–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–æ–±–∞–≤–ª–µ–Ω—ã –≤ `requirements.txt`:
```
Pillow>=10.0.0         # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
pdf2image>=1.16.0      # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥)
pypdfium2>=4.0.0       # –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ PDF —Å—Ç—Ä–∞–Ω–∏—Ü (–æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥)
```

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `_optimize_image_for_vision()`
```python
def _optimize_image_for_vision(
    image_path: str, 
    max_size: Tuple[int, int] = (512, 512), 
    quality: int = 85
) -> Optional[str]:
    """
    –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤:
    - –ò–∑–º–µ–Ω—è–µ—Ç —Ä–∞–∑–º–µ—Ä –¥–æ max_size
    - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ RGB
    - –°–∂–∏–º–∞–µ—Ç JPEG —Å –∑–∞–¥–∞–Ω–Ω—ã–º quality
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç base64 —Å—Ç—Ä–æ–∫—É
    """
```

#### `_read_pdf_as_images()`
```python
def _read_pdf_as_images(
    pdf_path: str, 
    max_pages: int = 10
) -> list:
    """
    –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç PDF –≤ —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
    - –†–µ–Ω–¥–µ—Ä–∏—Ç –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ pypdfium2
    - –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ base64 —Å—Ç—Ä–æ–∫
    """
```

### –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

**–û–¥–∏–Ω–æ—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**
```
[IMAGE_DATA:base64_encoded_jpeg_data]
```

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ PDF:**
```
[PAGE_1_IMAGE_DATA:base64_encoded_jpeg_data]
[PAGE_2_IMAGE_DATA:base64_encoded_jpeg_data]
...
```

–≠—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç:
- –õ–µ–≥–∫–æ –ø–∞—Ä—Å–∏—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏
- –ù–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –æ–±—ã—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ/–∑–∞–º–µ–Ω—É –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏

## –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–∞—Ö

–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∞–≥–µ–Ω—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:

```
üì∑ –†–ê–ë–û–¢–ê –° –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø–ú–ò –ò PDF:
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç read_file —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á—Ç–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (JPEG, PNG, GIF –∏ –¥—Ä.) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.
–ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ PDF –¥–æ–∫—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü.
–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–¥–∏—Ä—É—é—Ç—Å—è –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤.
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –°–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã - —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ —Ä–∞–±–æ—Ç—ã.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω—ã –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã:

### 1. `test_image_support.py`
- –¢–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ read_file
- –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è PDF —á–µ—Ä–µ–∑ read_file
- –¢–µ—Å—Ç –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã)
- –¢–µ—Å—Ç –ø–æ–¥—Å—á–µ—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

### 2. `test_compression_images.py`
- –¢–µ—Å—Ç —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
- –¢–µ—Å—Ç —Å–∂–∞—Ç–∏—è –±–ª–æ–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏
- –¢–µ—Å—Ç —Å–∂–∞—Ç–∏—è –±–ª–æ–∫–∞ –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### 3. `demo_image_workflow.py`
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –ß—Ç–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ß—Ç–µ–Ω–∏–µ –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã—Ö PDF
- –û—Ü–µ–Ω–∫–∞ —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 85% —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
‚úÖ PDF: 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PNG, JPEG, GIF, BMP, TIFF, WebP
‚úÖ –°–∂–∞—Ç–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: 0 —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ CodeQL)
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–†–∞–∑–º–µ—Ä PDF**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 —Å—Ç—Ä–∞–Ω–∏—Ü (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
2. **–ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–æ 512x512 –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –¥–ª—è –º–µ–ª–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π
3. **–¢–æ–∫–µ–Ω—ã**: –ö–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ = ~65 —Ç–æ–∫–µ–Ω–æ–≤, –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è –±–æ–ª—å—à–∏—Ö PDF**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
2. **–î–ª—è OCR**: –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ pytesseract –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
3. **–î–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–∏–¥–Ω–∞ –ø–æ—Å–ª–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ 512x512

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è:

1. **OCR –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π
4. **–°–µ–ª–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –í—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü PDF –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
5. **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–Ω–∞–ª–∏–∑ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞

```python
agent.run_cycle("–ü—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª screenshot.png –∏ –æ–ø–∏—à–∏ —á—Ç–æ –Ω–∞ –Ω—ë–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–æ")

# –ê–≥–µ–Ω—Ç:
# 1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç read_file("screenshot.png")
# 2. –ü–æ–ª—É—á–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
# 3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
# 4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ
```

### –ü—Ä–∏–º–µ—Ä 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

```python
agent.run_cycle("–ü—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª report.pdf –∏ –∏–∑–≤–ª–µ–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã")

# –ê–≥–µ–Ω—Ç:
# 1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç read_file("report.pdf")
# 2. –ü–æ–ª—É—á–∞–µ—Ç 3 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
# 3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
# 4. –°–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑—é–º–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤—ã–≤–æ–¥–æ–≤
```

### –ü—Ä–∏–º–µ—Ä 3: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

```python
agent.run_cycle("–°—Ä–∞–≤–Ω–∏ image1.jpg –∏ image2.jpg, –Ω–∞–π–¥–∏ –æ—Ç–ª–∏—á–∏—è")

# –ê–≥–µ–Ω—Ç:
# 1. –ß–∏—Ç–∞–µ—Ç –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: read_file("image1.jpg")
# 2. –ß–∏—Ç–∞–µ—Ç –≤—Ç–æ—Ä–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: read_file("image2.jpg")
# 3. –û–±–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (2 * 65 = 130 —Ç–æ–∫–µ–Ω–æ–≤)
# 4. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –Ω–∞—Ö–æ–¥–∏—Ç –æ—Ç–ª–∏—á–∏—è
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ PDF –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–≥–µ–Ω—Ç–∞, –ø–æ–∑–≤–æ–ª—è—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–æ—Å—Ç–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤. –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–∂–∞—Ç–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –¥–∞–∂–µ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, —Å–∂–∏–º–∞—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –±–ª–æ–∫–∏ –≤–º–µ—Å—Ç–æ –¥—Ä–æ–ø–∞ –≤—Å–µ–π —Å–µ—Å—Å–∏–∏.
