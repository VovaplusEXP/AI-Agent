# AI Agent - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–í–µ—Ä—Å–∏—è:** 3.0.0  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 10.10.2025  
**LLM:** Gemma-3n-E4B (GGUF, IQ4_XS)

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
3. [**–ù–æ–≤–æ–µ:** –§–ª–∞–≥–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç v3.0.0](#—Ñ–ª–∞–≥–æ–≤—ã–π-—Ñ–æ—Ä–º–∞—Ç-v300)
4. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
5. [–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã](#–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)
6. [–°–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏](#—Å–∏—Å—Ç–µ–º–∞-–ø–∞–º—è—Ç–∏)
7. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º)
8. [API Reference](#api-reference)
9. [Troubleshooting](#troubleshooting)
10. [–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π](#–∏—Å—Ç–æ—Ä–∏—è-–∏–∑–º–µ–Ω–µ–Ω–∏–π)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
AI Agent ‚Äî –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∞–≥–µ–Ω—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–∫–∞–ª—å–Ω–æ–π LLM (Gemma-3n-E4B), —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω **ReAct** (Reason-Act-Observe) –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π CLI.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### ü§ñ ReAct –ê–≥–µ–Ω—Ç
- –ê–≤—Ç–æ–Ω–æ–º–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö –∑–∞–¥–∞—á
- –¶–∏–∫–ª: **Thought ‚Üí Action ‚Üí Observation**
- –ü–ª–∞–Ω-–∏-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å —Å–∞–º–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π —á–µ—Ä–µ–∑ Self-Reflection
- –ú–∞–∫—Å–∏–º—É–º 10 —Ü–∏–∫–ª–æ–≤ –Ω–∞ –∑–∞–¥–∞—á—É

#### üöÄ **–ù–û–í–û–ï –≤ v3.0.0: –§–ª–∞–≥–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç**
- **100% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞** (–±—ã–ª–æ ~90% –≤ v2.1.2)
- **Regex –±–µ–∑ –æ—à–∏–±–æ–∫** - escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–¥–µ–∞–ª—å–Ω–æ
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å +30%** - –Ω–µ—Ç –¥–≤—É—Ö—à–∞–≥–æ–≤–æ–π –æ—á–∏—Å—Ç–∫–∏ JSON
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback** –Ω–∞ JSON –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- üìÑ [–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ v3.0.0](versions/v3.0.0/README.md)

#### üß† –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –ø–∞–º—è—Ç—å
- **L1 (–†–∞–±–æ—á–∞—è):** scratchpad —Å —Ç–µ–∫—É—â–∏–º –ø–ª–∞–Ω–æ–º –∏ —Ü–µ–ª—å—é
- **L2 (–≠–ø–∏–∑–æ–¥–∏—á–µ—Å–∫–∞—è):** –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- **L3 (–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è):** –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ø–∞–º—è—Ç—å (FAISS + SentenceTransformer)
- **–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –≥–ª–æ–±–∞–ª—å–Ω–∞—è + –ø—Ä–æ–µ–∫—Ç–Ω–∞—è –ø–∞–º—è—Ç—å

#### üí¨ –°–∏—Å—Ç–µ–º–∞ —á–∞—Ç–æ–≤
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —á–∞—Ç—ã —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫ (–∏—Å—Ç–æ—Ä–∏—è + scratchpad + –ø—Ä–æ–µ–∫—Ç–Ω–∞—è –ø–∞–º—è—Ç—å)
- –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —á–∞—Ç–∞–º–∏
- –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á

#### üîß –ë–æ–≥–∞—Ç—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π (—á—Ç–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ Python-–∫–æ–¥–∞ —á–µ—Ä–µ–∑ AST
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ shell-–∫–æ–º–∞–Ω–¥
- –ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–∞–º—è—Ç—å—é

#### ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –æ–∫–Ω–æ: **24,576 —Ç–æ–∫–µ–Ω–æ–≤** (—É–≤–µ–ª–∏—á–µ–Ω–æ –≤ v3.3.1)
- Flash Attention –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ 20-30% VRAM
- KV-–∫—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤ VRAM –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ CUDA
- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Å —É—Ç–∏–ª–∏–∑–∞—Ü–∏–µ–π 85-95%

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **Python:** 3.11+
- **LLM:** llama-cpp-python + Gemma-3n-E4B GGUF
- **–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î:** FAISS
- **–≠–º–±–µ–¥–¥–∏–Ω–≥–∏:** SentenceTransformer (all-MiniLM-L6-v2)
- **UI:** Rich + Prompt Toolkit
- **–¢–µ—Å—Ç—ã:** pytest

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3.11 -m venv venv
source venv/bin/activate

# 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø–æ–∏—Å–∫–∞)
cp .env.example .env
# –î–æ–±–∞–≤–∏—Ç—å GOOGLE_API_KEY –∏ GOOGLE_CSE_ID

# 4. –ü–æ–º–µ—Å—Ç–∏—Ç—å GGUF –º–æ–¥–µ–ª—å –≤ ai/
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: Gemma-3n-E4B-it-IQ4_XS.gguf
# –°–∫–∞—á–∞—Ç—å: https://huggingface.co/...
```

### –ó–∞–ø—É—Å–∫

```bash
source venv/bin/activate
python cli.py
```

### –ü–µ—Ä–≤—ã–µ —à–∞–≥–∏

```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç
/new my_project "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"

# –ó–∞–¥–∞—Ç—å –∑–∞–¥–∞—á—É –∞–≥–µ–Ω—Ç—É
>>> –°–æ–∑–¥–∞–π —Ñ–∞–π–ª calculator.py —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —Å–ª–æ–∂–µ–Ω–∏—è –∏ —É–º–Ω–æ–∂–µ–Ω–∏—è

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
Ctrl+O   # Shell-—Ä–µ–∂–∏–º –¥–ª—è –ø—Ä—è–º—ã—Ö –∫–æ–º–∞–Ω–¥
Ctrl+O   # –û–±—Ä–∞—Ç–Ω–æ –≤ —á–∞—Ç-—Ä–µ–∂–∏–º

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–∞
/save "–î–æ–±–∞–≤–ª–µ–Ω –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–∞—Ç–∞
/switch –¥—Ä—É–≥–æ–π_—á–∞—Ç

# –í—ã—Ö–æ–¥
/exit
```

---

## –§–ª–∞–≥–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç v3.0.0

### –ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∏–ª–∏

**–î–æ v3.0.0 (JSON):**
```json
{
  "thought": "–°–æ–∑–¥–∞–º regex –¥–ª—è email",
  "tool_name": "write_file",
  "tool_params": {"file_path": "validate.py"},
  "content": "pattern = r'\\d+\\.\\d+'"  // ‚ùå JSONDecodeError!
}
```

**–ü—Ä–æ–±–ª–µ–º—ã JSON:**
- Escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ regex –ª–æ–º–∞—é—Ç –ø–∞—Ä—Å–∏–Ω–≥
- Bash-—Å–∫—Ä–∏–ø—Ç—ã —Å `$variables` —Ç—Ä–µ–±—É—é—Ç —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- Windows –ø—É—Ç–∏ `C:\\Users\\...` —É–¥–≤–∞–∏–≤–∞—é—Ç —Å–ª–µ—à–∏
- –î–≤—É—Ö—à–∞–≥–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ (pre-cleaning) –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É

**–ü–æ—Å–ª–µ v3.0.0 (–§–ª–∞–≥–∏):**
```
<THOUGHT>
–°–æ–∑–¥–∞–º regex –¥–ª—è email
<TOOL>
write_file
<PARAMS>
{"file_path": "validate.py"}
<CONTENT>
pattern = r'\d+\.\d+'  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ!
<END>
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ñ–ª–∞–≥–æ–≤:**
- ‚úÖ **100% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞** (–±—ã–ª–æ ~90%)
- ‚úÖ **Regex –±–µ–∑ –æ—à–∏–±–æ–∫** - –ª—é–±—ã–µ `\d`, `\w`, `\.` —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å +30%** - –Ω–µ—Ç pre-cleaning
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —á–µ—Ä–µ–∑ fallback

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å —Ñ–ª–∞–≥–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏

```
<THOUGHT>
[–†–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –æ –∑–∞–¥–∞—á–µ]
<TOOL>
[–ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞]
<PARAMS>
{"param1": "value1", "param2": "value2"}
<END>
```

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–ª–æ–∫ CONTENT

–î–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º (write_file, edit_file_at_line):

```
<THOUGHT>
–°–æ–∑–¥–∞–º Python-—Å–∫—Ä–∏–ø—Ç
<TOOL>
write_file
<PARAMS>
{"file_path": "script.py"}
<CONTENT>
import re

def validate_email(email):
    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    return re.match(pattern, email) is not None
<END>
```

**–ü—Ä–∞–≤–∏–ª–∞ CONTENT:**
- –í—Å—ë –º–µ–∂–¥—É `<CONTENT>` –∏ `<END>` - —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç
- –ù–∏–∫–∞–∫–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- Regex, bash, JSON, XML - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –µ—Å—Ç—å

#### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç finish

```
<THOUGHT>
–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
<TOOL>
finish
<PARAMS>
{"message": "–§–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω"}
<END>
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ü—Ä–∏–º–µ—Ä 1: Regex –±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```
<THOUGHT>
–°–æ–∑–¥–∞–º –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è IP-–∞–¥—Ä–µ—Å–æ–≤ —Å regex
<TOOL>
write_file
<PARAMS>
{"file_path": "ip_validator.py"}
<CONTENT>
import re

def validate_ip(ip):
    # Regex –¥–ª—è IPv4
    pattern = r'^(\d{1,3}\.){3}\d{1,3}$'
    if not re.match(pattern, ip):
        return False
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ 0-255
    return all(0 <= int(octet) <= 255 for octet in ip.split('.'))

# –¢–µ—Å—Ç—ã
print(validate_ip('192.168.1.1'))  # True
print(validate_ip('256.1.1.1'))    # False
<END>
```

#### –ü—Ä–∏–º–µ—Ä 2: Bash-—Å–∫—Ä–∏–ø—Ç —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

```
<THOUGHT>
–°–æ–∑–¥–∞–º bash-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
<TOOL>
write_file
<PARAMS>
{"file_path": "backup.sh"}
<CONTENT>
#!/bin/bash

SOURCE_DIR="/home/user/data"
BACKUP_DIR="/mnt/backup"
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")

echo "Starting backup at $TIMESTAMP"
tar -czf "$BACKUP_DIR/backup_$TIMESTAMP.tar.gz" "$SOURCE_DIR"

if [ $? -eq 0 ]; then
    echo "Backup completed successfully"
else
    echo "Backup failed!" >&2
    exit 1
fi
<END>
```

#### –ü—Ä–∏–º–µ—Ä 3: JSON –≤ –∫–æ–¥–µ

```
<THOUGHT>
–°–æ–∑–¥–∞–º Python-—Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON API
<TOOL>
write_file
<PARAMS>
{"file_path": "api_client.py"}
<CONTENT>
import json
import requests

def call_api(endpoint):
    response = requests.get(f"https://api.example.com/{endpoint}")
    data = response.json()
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º JSON —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏
    formatted = json.dumps(data, indent=2, ensure_ascii=False)
    print(formatted)
    
    return data

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
config = {
    "api_key": "abc123",
    "timeout": 30,
    "retry": True
}
print(json.dumps(config))
<END>
```

#### –ü—Ä–∏–º–µ—Ä 4: Windows –ø—É—Ç–∏

```
<THOUGHT>
–°–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è Windows —Å –ø—É—Ç—è–º–∏
<TOOL>
write_file
<PARAMS>
{"file_path": "windows_paths.py"}
<CONTENT>
import os

# Windows –ø—É—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
data_path = "C:\\Users\\Admin\\Documents\\data.txt"
config_path = "C:\\Program Files\\MyApp\\config.ini"

def check_path(path):
    return os.path.exists(path)

print(f"Checking {data_path}: {check_path(data_path)}")
<END>
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞—Ä—Å–µ—Ä–∞

**–ú–æ–¥—É–ª—å:** `parsers.py` (252 —Å—Ç—Ä–æ–∫–∏)

**–§—É–Ω–∫—Ü–∏–∏:**

1. **`parse_flagged_response(response: str) -> dict`**
   - –ü–∞—Ä—Å–∏—Ç —Ñ–ª–∞–≥–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç regex –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –±–ª–æ–∫–æ–≤
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"thought": "...", "tool_name": "...", "tool_params": {...}, "content": "..."}`

2. **`parse_json_response(response: str) -> dict`**
   - Legacy –ø–∞—Ä—Å–µ—Ä –¥–ª—è JSON v2.1.2
   - –î–≤—É—Ö—à–∞–≥–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
   - Fallback –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

3. **`parse_response_with_fallback(response: str) -> dict`**
   - –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
   - –ü—Ä–æ–±—É–µ—Ç —Ñ–ª–∞–≥–∏ –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º
   - –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ JSON
   - –ï—Å–ª–∏ –æ–±–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç - –ø–æ–¥–Ω–∏–º–∞–µ—Ç ValueError

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```python
from parsers import parse_response_with_fallback

raw_response = """
<THOUGHT>
–°–æ–∑–¥–∞–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email
<TOOL>
write_file
<PARAMS>
{"file_path": "validate.py"}
<CONTENT>
import re

pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'

def validate_email(email):
    return bool(re.match(pattern, email))
<END>
"""

parsed = parse_response_with_fallback(raw_response)
# {
#   "thought": "–°–æ–∑–¥–∞–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email",
#   "tool_name": "write_file",
#   "tool_params": {"file_path": "validate.py"},
#   "content": "import re\n\npattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$'\n\ndef validate_email(email):\n    return bool(re.match(pattern, email))"
# }
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `tests/test_flag_parser.py` (15 unit-—Ç–µ—Å—Ç–æ–≤)

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π —Ñ–∞–π–ª –±–µ–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- ‚úÖ Regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã (email, IP, URL)
- ‚úÖ JSON –≤ –∫–æ–¥–µ Python
- ‚úÖ –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- ‚úÖ Bash-—Å–∫—Ä–∏–ø—Ç—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ (thought, content)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
- ‚úÖ Legacy JSON –ø–∞—Ä—Å–µ—Ä
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 15/15 passed (0.03s)

**Integration —Ç–µ—Å—Ç:** `test_v3_integration.py`
- –†–µ–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞: "Create validate_email.py with regex pattern"
- –¶–∏–∫–ª—ã: write_file ‚Üí run_shell_command ‚Üí finish
- –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω –±–µ–∑ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞

### –ú–∏–≥—Ä–∞—Ü–∏—è —Å v2.1.2

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è:** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –Ω–∞ JSON, –µ—Å–ª–∏ –∞–≥–µ–Ω—Ç –≤–µ—Ä–Ω—ë—Ç —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç.

**–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è (–¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤):**
1. –û–±–Ω–æ–≤–∏—Ç–µ system prompt –≤ `agent.py` (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ v3.0.0)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `parse_response_with_fallback` (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
3. –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ tools.py –∏–ª–∏ cli.py –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–ü—Ä–∏–º–µ—Ä—ã –≤ system prompt:**
–ê–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –≤–∏–¥–∏—Ç 4 –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞ —Ñ–ª–∞–≥–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:
1. list_directory (–±–µ–∑ content)
2. write_file —Å regex (—Å content)
3. Bash-—Å–∫—Ä–∏–ø—Ç (—Å content –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏)
4. finish (–±–µ–∑ content)

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | v2.1.2 (JSON) | v3.0.0 (–§–ª–∞–≥–∏) | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|---------------|----------------|-----------|
| **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞** | ~90% | 100% | +10% |
| **–°–∫–æ—Ä–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞** | 15ms | 10ms | +33% |
| **Regex –ø–æ–¥–¥–µ—Ä–∂–∫–∞** | –ß–∞—Å—Ç–∏—á–Ω–æ | –ü–æ–ª–Ω–∞—è | ‚úÖ |
| **Bash –ø–æ–¥–¥–µ—Ä–∂–∫–∞** | –ü—Ä–æ–±–ª–µ–º—ã | –ü–æ–ª–Ω–∞—è | ‚úÖ |
| **Windows –ø—É—Ç–∏** | –î–≤–æ–π–Ω–æ–µ `\\` | –ü—Ä—è–º–æ `\` | ‚úÖ |

**–í—ã–≤–æ–¥:** v3.0.0 —Ä–µ—à–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ä–∞–∑ –∏ –Ω–∞–≤—Å–µ–≥–¥–∞.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/home/vova/AI/
‚îú‚îÄ‚îÄ agent.py              # –Ø–¥—Ä–æ ReAct –∞–≥–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ cli.py                # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π TUI
‚îú‚îÄ‚îÄ tools.py              # –ù–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ memory.py             # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ø–∞–º—è—Ç—å (FAISS)
‚îú‚îÄ‚îÄ context_manager.py    # –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
‚îú‚îÄ‚îÄ chat_manager.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏
‚îú‚îÄ‚îÄ requirements.txt      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ pytest.ini            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ .env                  # API –∫–ª—é—á–∏ (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ ai/
‚îÇ   ‚îî‚îÄ‚îÄ gemma-3n-E4B-it-IQ4_XS.gguf  # LLM –º–æ–¥–µ–ª—å
‚îú‚îÄ‚îÄ logs/                 # –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞ (–ø–æ –¥–Ω—è–º)
‚îú‚îÄ‚îÄ memory/
‚îÇ   ‚îî‚îÄ‚îÄ global/          # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ø–∞–º—è—Ç—å
‚îÇ       ‚îú‚îÄ‚îÄ index.faiss
‚îÇ       ‚îî‚îÄ‚îÄ storage.json
‚îú‚îÄ‚îÄ chats/               # –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —á–∞—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ <chat_name>/
‚îÇ       ‚îú‚îÄ‚îÄ metadata.json
‚îÇ       ‚îú‚îÄ‚îÄ history.json
‚îÇ       ‚îú‚îÄ‚îÄ scratchpad.json
‚îÇ       ‚îî‚îÄ‚îÄ memory/      # –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –ø–∞–º—è—Ç—å
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ‚îÄ test_tools.py
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- **ReAct (Reason-Act-Observe):** –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –º—ã—à–ª–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞
- **Plan-and-Execute:** –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
- **Self-Reflection:** –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –∏ —Å–∞–º–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è
- **RAG (Retrieval-Augmented Generation):** –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ø–∞–º—è—Ç—å –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **Singleton:** –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

### –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 CLI (cli.py)                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇChat Mode ‚îÇ  ‚îÇShell Mode‚îÇ  ‚îÇCommand Handler   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ (ReAct)  ‚îÇ  ‚îÇ (Ctrl+O) ‚îÇ  ‚îÇ(/new, /save)     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Agent (agent.py)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ         ReAct Cycle (run_cycle)              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  User Input ‚Üí Build Context ‚Üí LLM Generate ‚Üí ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Üí Parse JSON ‚Üí Execute Tool ‚Üí Observation ‚Üí ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Üí [Self-Reflection if error] ‚Üí [Repeat]     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ Llama  ‚îÇ ‚îÇContext Mgr  ‚îÇ ‚îÇChat Mgr‚îÇ ‚îÇMem Mgr ‚îÇ ‚îÇ
‚îÇ  ‚îÇ(20k ctx)‚îÇ ‚îÇ(Adaptive)   ‚îÇ ‚îÇ(Persist)‚îÇ ‚îÇ(FAISS) ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Tools (tools.py)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇFile  ‚îÇ ‚îÇWeb   ‚îÇ ‚îÇShell ‚îÇ ‚îÇMemory‚îÇ ‚îÇanalyze_  ‚îÇ ‚îÇ
‚îÇ  ‚îÇSystem‚îÇ ‚îÇFetch ‚îÇ ‚îÇCmd   ‚îÇ ‚îÇOps   ‚îÇ ‚îÇcode      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### ReAct —Ü–∏–∫–ª (–¥–µ—Ç–∞–ª—å–Ω–æ)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ START: User Input                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. BUILD CONTEXT (ContextManager)                   ‚îÇ
‚îÇ    ‚îú‚îÄ System prompt (10-20%)                        ‚îÇ
‚îÇ    ‚îú‚îÄ Scratchpad: –ø–ª–∞–Ω + —Ü–µ–ª—å (5-15%)               ‚îÇ
‚îÇ    ‚îú‚îÄ L3 Memory: —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (10-30%)        ‚îÇ
‚îÇ    ‚îú‚îÄ L2 History: –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (30-70%)      ‚îÇ
‚îÇ    ‚îî‚îÄ Current query                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. LLM GENERATION (Gemma-3n)                        ‚îÇ
‚îÇ    Input: context (–¥–æ 20k —Ç–æ–∫–µ–Ω–æ–≤)                  ‚îÇ
‚îÇ    Output: JSON —Å thought + action                  ‚îÇ
‚îÇ    Format: {"thought": "...", "action": {...}}      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. JSON PARSING                                     ‚îÇ
‚îÇ    ‚îú‚îÄ –û—á–∏—Å—Ç–∫–∞ escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π           ‚îÇ
‚îÇ    ‚îú‚îÄ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Å–∫–æ–±–æ–∫                           ‚îÇ
‚îÇ    ‚îú‚îÄ json.loads() —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫              ‚îÇ
‚îÇ    ‚îî‚îÄ Retry –¥–æ 5 —Ä–∞–∑ –ø—Ä–∏ –æ—à–∏–±–∫–µ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. TOOL EXECUTION                                   ‚îÇ
‚îÇ    ‚îú‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ tool_name –∏ parameters             ‚îÇ
‚îÇ    ‚îú‚îÄ –í—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏                 ‚îÇ
‚îÇ    ‚îú‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞/–æ—à–∏–±–∫–∏                   ‚îÇ
‚îÇ    ‚îî‚îÄ –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ + cycles>1 ‚Üí Self-Reflection      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. OBSERVATION                                      ‚îÇ
‚îÇ    ‚îú‚îÄ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞                     ‚îÇ
‚îÇ    ‚îú‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é                          ‚îÇ
‚îÇ    ‚îú‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ scratchpad                         ‚îÇ
‚îÇ    ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç—å (–µ—Å–ª–∏ –≤–∞–∂–Ω–æ)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 6. DECISION                                         ‚îÇ
‚îÇ    ‚îú‚îÄ tool_name == "finish" ‚Üí END                   ‚îÇ
‚îÇ    ‚îú‚îÄ cycles >= 10 ‚Üí END (–ª–∏–º–∏—Ç)                    ‚îÇ
‚îÇ    ‚îú‚îÄ errors >= 5 ‚Üí END (—Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫)      ‚îÇ
‚îÇ    ‚îî‚îÄ –ò–Ω–∞—á–µ ‚Üí GOTO 1 (—Å–ª–µ–¥—É—é—â–∏–π —Ü–∏–∫–ª)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Self-Reflection –º–µ—Ö–∞–Ω–∏–∑–º

–ö–æ–≥–¥–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π –∏ –æ—Å—Ç–∞–ª–æ—Å—å >1 —Ü–∏–∫–ª–∞:

```python
# 1. –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–∫–∏
reflection_prompt = f"""
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç {tool_name} —É–ø–∞–ª —Å –æ—à–∏–±–∫–æ–π:
{error_message}

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—à–µ–Ω–∏–µ.
"""

# 2. LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç (512 —Ç–æ–∫–µ–Ω–æ–≤, temperature=0.3)
analysis = llm.create_completion(reflection_prompt)

# 3. –ê–Ω–∞–ª–∏–∑ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ Observation
observation = f"""
‚ùå –û—à–∏–±–∫–∞: {error_message}
ü§î Self-Reflection: {analysis}
"""

# 4. –ê–≥–µ–Ω—Ç –≤–∏–¥–∏—Ç –∞–Ω–∞–ª–∏–∑ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –ø–æ–¥—Ö–æ–¥ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ü–∏–∫–ª–µ
```

–ü—Ä–∏–º–µ—Ä:
```
Tool: read_file("/tmp/nofile.txt")
Error: FileNotFoundError

Self-Reflection:
‚ùå –û—à–∏–±–∫–∞: —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
ü§î –ê–Ω–∞–ª–∏–∑: –ü—É—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–º. 
   –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –°–Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–π list_directory("/tmp") 
   —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∞–π–ª—ã, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π.

‚Üí –ê–≥–µ–Ω—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ü–∏–∫–ª–µ –≤—ã–∑—ã–≤–∞–µ—Ç list_directory
```

---

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

–ê–≥–µ–Ω—Ç –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–ª–µ–¥—É—é—â–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á.

### –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π

#### `list_directory(path: str) -> str`
–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `path` (str): –ü—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞

**–ü—Ä–∏–º–µ—Ä:**
```python
result = list_directory("/home/vova/AI")
# –í—ã–≤–æ–¥:
# üìÅ /home/vova/AI:
# - agent.py (—Ñ–∞–π–ª)
# - tools.py (—Ñ–∞–π–ª)
# - logs/ (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è)
```

---

#### `read_file(file_path: str) -> str`
–ß—Ç–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ PDF-–¥–æ–∫—É–º–µ–Ω—Ç—ã.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file_path` (str): –ü—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Ñ–∞–π–ª—É (–ù–ï URL)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ (—Ç–µ–∫—Å—Ç, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã PDF)

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**

*–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:* –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∫ –µ—Å—Ç—å.

*–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPEG, PNG, GIF, BMP, TIFF, WebP):*
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –¥–æ 512x512 –ø–∏–∫—Å–µ–ª–µ–π (—Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ JPEG –∫–∞—á–µ—Å—Ç–≤–æ 85
- –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ base64: `[IMAGE_DATA:...]`
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~65 —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (—ç–∫–æ–Ω–æ–º–∏—è 85% vs –æ—Ä–∏–≥–∏–Ω–∞–ª)

*PDF –¥–æ–∫—É–º–µ–Ω—Ç—ã:*
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º 150 DPI
- –§–æ—Ä–º–∞—Ç: `[PAGE_1_IMAGE_DATA:...]`, `[PAGE_2_IMAGE_DATA:...]`
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ 10 –ø–µ—Ä–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~65 —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
# –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
content = read_file("config.json")

# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
img = read_file("screenshot.png")
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: üì∑ –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï: screenshot.png
#             –†–∞–∑–º–µ—Ä: 13.17 –ö–ë, –§–æ—Ä–º–∞—Ç: PNG
#             [IMAGE_DATA:base64...]

# PDF –¥–æ–∫—É–º–µ–Ω—Ç
pdf = read_file("report.pdf")
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: üìÑ PDF –î–û–ö–£–ú–ï–ù–¢: report.pdf
#             –°—Ç—Ä–∞–Ω–∏—Ü –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 3
#             [PAGE_1_IMAGE_DATA:...]
#             [PAGE_2_IMAGE_DATA:...]
```

---

#### `write_file(file_path: str, content: str) -> str`
–ó–∞–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤ —Ñ–∞–π–ª (—Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file_path` (str): –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
- `content` (str): –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –∑–∞–ø–∏—Å–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

**–ü—Ä–∏–º–µ—Ä:**
```python
write_file("hello.py", "print('Hello, World!')")
# ‚úÖ –§–∞–π–ª hello.py —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω
```

---

#### `replace_in_file(file_path: str, old_code: str, new_code: str) -> str`
–ó–∞–º–µ–Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –∫–æ–¥–∞ –≤ —Ñ–∞–π–ª–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file_path` (str): –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
- `old_code` (str): –ö–æ–¥ –¥–ª—è –∑–∞–º–µ–Ω—ã (–¥–æ–ª–∂–µ–Ω —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å)
- `new_code` (str): –ù–æ–≤—ã–π –∫–æ–¥

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ

**–ü—Ä–∏–º–µ—Ä:**
```python
replace_in_file(
    "main.py",
    "def old_function():\n    pass",
    "def new_function():\n    return True"
)
```

**–í–∞–∂–Ω–æ:** `old_code` –¥–æ–ª–∂–µ–Ω **—Ç–æ—á–Ω–æ** —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —Ñ–∞–π–ª–∞, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç—Ä–æ–∫.

---

#### `analyze_code(file_path: str) -> str` üÜï v2.1.0
–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ Python-—Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ AST (–±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file_path` (str): –ü—É—Ç—å –∫ Python-—Ñ–∞–π–ª—É

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç:
  - üì¶ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–æ–∫
  - üèõÔ∏è –ö–ª–∞—Å—Å—ã —Å –∏—Ö –º–µ—Ç–æ–¥–∞–º–∏
  - ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–∏ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è —Å —Å–∏–≥–Ω–∞—Ç—É—Ä–∞–º–∏
  - üîß –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ/–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
  - üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞, –∫–ª–∞—Å—Å—ã, —Ñ—É–Ω–∫—Ü–∏–∏)

**–ü—Ä–∏–º–µ—Ä:**
```python
result = analyze_code("agent.py")

# –í—ã–≤–æ–¥:
# üìä –ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–∞: agent.py
# 
# üì¶ –ò–º–ø–æ—Ä—Ç—ã:
#   ‚Ä¢ import json (—Å—Ç—Ä–æ–∫–∞ 1)
#   ‚Ä¢ from pathlib import Path (—Å—Ç—Ä–æ–∫–∞ 2)
#   ‚Ä¢ from llama_cpp import Llama (—Å—Ç—Ä–æ–∫–∞ 5)
# 
# üèõÔ∏è –ö–ª–∞—Å—Å—ã:
#   ‚Ä¢ Agent (—Å—Ç—Ä–æ–∫–∞ 20)
#     –ú–µ—Ç–æ–¥—ã:
#       - __init__(self, model_path, **kwargs)
#       - run_cycle(self, user_input)
#       - new_chat(self, chat_name, description)
# 
# ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–∏ (–≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è):
#   ‚Ä¢ def main() (—Å—Ç—Ä–æ–∫–∞ 500)
# 
# üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 529 —Å—Ç—Ä–æ–∫, 1 –∫–ª–∞—Å—Å, 1 —Ñ—É–Ω–∫—Ü–∏—è
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- ‚úÖ –ù—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–µ–∑–Ω–∞–∫–æ–º–æ–≥–æ —Ñ–∞–π–ª–∞
- ‚úÖ –ò—â–µ—à—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –•–æ—á–µ—à—å —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤/–º–µ—Ç–æ–¥–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—à—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–≥–¥–∞:**
- ‚ùå –ù—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ—É–Ω–∫—Ü–∏–π (–∏—Å–ø–æ–ª—å–∑—É–π `read_file`)
- ‚ùå –§–∞–π–ª –Ω–µ Python
- ‚ùå –ù—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥ (–∏—Å–ø–æ–ª—å–∑—É–π `run_shell_command`)

---

#### `edit_file_at_line(file_path: str, start_line: int, end_line: int, new_content: str) -> str` üÜï v2.1.0
–¢–æ—á–µ—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ –Ω–æ–º–µ—Ä–∞–º —Å—Ç—Ä–æ–∫.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file_path` (str): –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
- `start_line` (int): –ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (1-based)
- `end_line` (int): –ö–æ–Ω–µ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (1-based)
- `new_content` (str): –ù–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

**–í–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
# 1. –ó–∞–º–µ–Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
edit_file_at_line("main.py", 42, 42, "new_function()")

# 2. –ó–∞–º–µ–Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —Å—Ç—Ä–æ–∫
edit_file_at_line("main.py", 10, 15, "merged_code")

# 3. –í—Å—Ç–∞–≤–∫–∞ —Å—Ç—Ä–æ–∫ (start == end + 1)
edit_file_at_line("main.py", 20, 19, "inserted_line")

# 4. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ (new_content –ø—É—Å—Ç–æ–π)
edit_file_at_line("main.py", 30, 35, "")
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ `replace_in_file`:**
- –ù–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Ç–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–æ–∫ (–∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥–Ω—ã –≤ `analyze_code`)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å—Ç–∞–≤–∫—É, –∑–∞–º–µ–Ω—É –∏ —É–¥–∞–ª–µ–Ω–∏–µ

**–¢–∏–ø–∏—á–Ω—ã–π workflow:**
```python
# 1. –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
result = analyze_code("file.py")
# –í–∏–¥–∏–º: "def process() –Ω–∞ —Å—Ç—Ä–æ–∫–µ 85"

# 2. –ß—Ç–µ–Ω–∏–µ –Ω—É–∂–Ω–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞
content = read_file("file.py")  # –§–æ–∫—É—Å –Ω–∞ —Å—Ç—Ä–æ–∫–µ 85

# 3. –¢–æ—á–µ—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
edit_file_at_line("file.py", 85, 90, "new_implementation")
```

---

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥

#### `run_shell_command(command: str) -> str`
–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ shell-–∫–æ–º–∞–Ω–¥—ã –≤ —Å–∏—Å—Ç–µ–º–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `command` (str): –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–ª–æ–≤–∞—Ä—å —Å `stdout`, `stderr` –∏ `exit_code`

**–ü—Ä–∏–º–µ—Ä:**
```python
result = run_shell_command("ls -la")
# Output:
# stdout: <—Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤>
# stderr: 
# exit_code: 0
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚ö†Ô∏è –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ö†Ô∏è –ù–µ—Ç –ø–µ—Å–æ—á–Ω–∏—Ü—ã –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –≤–≤–æ–¥–æ–º

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞
run_shell_command("pip install requests")

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
run_shell_command("pytest tests/")

# Git –æ–ø–µ—Ä–∞—Ü–∏–∏
run_shell_command("git status")
```

---

### –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –≤–µ–±

#### `internet_search(query: str) -> str`
–ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —á–µ—Ä–µ–∑ Google Custom Search API.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (str): –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –¢–æ–ø-5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, URL –∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `GOOGLE_API_KEY`, `GOOGLE_CSE_ID`

**–ü—Ä–∏–º–µ—Ä:**
```python
results = internet_search("Python asyncio tutorial")
# –í—ã–≤–æ–¥:
# 1. Asyncio ‚Äî Asynchronous I/O
#    https://docs.python.org/3/library/asyncio.html
#    Official Python documentation...
```

---

#### `web_fetch(url: str) -> str`
–ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `url` (str): URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (–±–µ–∑ HTML-—Ç–µ–≥–æ–≤)

**–ü—Ä–∏–º–µ—Ä:**
```python
content = web_fetch("https://example.com/article")
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –¢–∞–π–º–∞—É—Ç: 10 —Å–µ–∫—É–Ω–¥
- –¢–æ–ª—å–∫–æ HTTP/HTTPS
- –ù–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç JavaScript

---

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

#### `remember(content: str, importance: str = "medium") -> str`
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—É—é –ø–∞–º—è—Ç—å.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `content` (str): –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
- `importance` (str): –í–∞–∂–Ω–æ—Å—Ç—å ("low", "medium", "high")

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä:**
```python
remember(
    "API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π: python server.py --port 8080",
    importance="high"
)
# ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ø–∞–º—è—Ç—å (–≤–∞–∂–Ω–æ—Å—Ç—å: high)
```

**–ú–µ—Ö–∞–Ω–∏–∑–º:**
- –¢–µ–∫—Å—Ç –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä (384 –∏–∑–º–µ—Ä–µ–Ω–∏—è)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ FAISS –∏–Ω–¥–µ–∫—Å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

---

#### `recall(query: str, scope: str = "global") -> str`
–ü–æ–∏—Å–∫ –≤ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–∞–º—è—Ç–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (str): –ß—Ç–æ –∏—Å–∫–∞—Ç—å
- `scope` (str): –û–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞ ("global", "project", "both")

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –¢–æ–ø-5 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π —Å –æ—Ü–µ–Ω–∫–∞–º–∏ —Å—Ö–æ–¥—Å—Ç–≤–∞

**–ü—Ä–∏–º–µ—Ä:**
```python
results = recall("–∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä", scope="both")
# –í—ã–≤–æ–¥:
# üîç –ù–∞–π–¥–µ–Ω–æ –≤ –ø–∞–º—è—Ç–∏ (both):
# 
# 1. [0.89] API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π: python server.py --port 8080
# 2. [0.72] –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π --reload —Ñ–ª–∞–≥
```

**–û–±–ª–∞—Å—Ç–∏ –ø–æ–∏—Å–∫–∞:**
- `global`: –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å (–≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã)
- `project`: –ü–∞–º—è—Ç—å —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞/–ø—Ä–æ–µ–∫—Ç–∞
- `both`: –û–±–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

---

#### `finish(result: str) -> str`
–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `result` (str): –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç/–æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ü—Ä–∏–º–µ—Ä:**
```python
finish("–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª calculator.py —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ add() –∏ multiply().")
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- ‚úÖ –ó–∞–¥–∞—á–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- ‚úÖ –ù—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
- ‚úÖ –î–∞–ª—å–Ω–µ–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è

---

## –°–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏

–ê–≥–µ–Ω—Ç –∏–º–µ–µ—Ç —Ç—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É –ø–∞–º—è—Ç–∏, —Ä–µ–∞–ª–∏–∑—É—é—â—É—é –ø–∞—Ç—Ç–µ—Ä–Ω RAG (Retrieval-Augmented Generation).

### L1: –†–∞–±–æ—á–∞—è –ø–∞–º—è—Ç—å (Scratchpad)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```python
{
    "goal": "–°–æ–∑–¥–∞—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–∞ Flask",
    "plan": [
        "1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Flask",
        "2. –°–æ–∑–¥–∞—Ç—å app.py —Å –±–∞–∑–æ–≤—ã–º —Ä–æ—É—Ç–æ–º",
        "3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä"
    ],
    "completed": ["1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Flask"],
    "current_step": "2. –°–æ–∑–¥–∞—Ç—å app.py"
}
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: —Ç–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞
- –†–∞–∑–º–µ—Ä: ~5-15% –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –û—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ
- –ù–µ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

---

### L2: –≠–ø–∏–∑–æ–¥–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å (–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–∏–∞–ª–æ–≥–µ.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```python
[
    {"role": "user", "content": "–°–æ–∑–¥–∞–π —Ñ–∞–π–ª test.py"},
    {"role": "assistant", "content": "Thought: ...\nAction: write_file(...)"},
    {"role": "user", "content": "–î–æ–±–∞–≤—å —Ñ—É–Ω–∫—Ü–∏—é sum()"},
    ...
]
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: —Ç–µ–∫—É—â–∏–π —á–∞—Ç
- –†–∞–∑–º–µ—Ä: ~30-70% –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)
- –û–±—Ä–µ–∑–∞–µ—Ç—Å—è –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ –ø—Ä–∏ `/save`

**–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å:**
- –ï—Å–ª–∏ –ø–∞–º—è—Ç—å L3 –ø—É—Å—Ç–∞—è ‚Üí –∏—Å—Ç–æ—Ä–∏—è –ø–æ–ª—É—á–∞–µ—Ç –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞
- –ï—Å–ª–∏ –ø–∞–º—è—Ç—å L3 –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí –∏—Å—Ç–æ—Ä–∏—è —Å–∂–∏–º–∞–µ—Ç—Å—è –¥–æ –º–∏–Ω–∏–º—É–º–∞ (30%)

---

### L3: –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å (–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏.

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- **FAISS:** –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **SentenceTransformer:** –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ –≤–µ–∫—Ç–æ—Ä–∞ (384D)
- **–ú–æ–¥–µ–ª—å:** all-MiniLM-L6-v2 (–ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à)

**–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

#### –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å (`memory/global/`)
- –û–±—â–∏–µ –∑–Ω–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- –ü—Ä–∏–º–µ—Ä: "Python –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏", "–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã"
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ –º–µ–∂–¥—É –≤—Å–µ–º–∏ —á–∞—Ç–∞–º–∏

#### –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –ø–∞–º—è—Ç—å (`chats/<chat_name>/memory/`)
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∑–Ω–∞–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
- –ü—Ä–∏–º–µ—Ä: "API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞", "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î"
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ (–ø–æ–∫–∞ –Ω–µ —É–¥–∞–ª–∏—à—å)
- –†–∞–∑–º–µ—Ä –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ: ~10-30% (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)
- k –ø–∞—Ä–∞–º–µ—Ç—Ä (–∫–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π):
  - –ì–ª–æ–±–∞–ª—å–Ω–∞—è: k=2 (–º–∏–Ω) –¥–æ k=5 (–º–∞–∫—Å)
  - –ü—Ä–æ–µ–∫—Ç–Ω–∞—è: k=3 (–º–∏–Ω) –¥–æ k=7 (–º–∞–∫—Å)

**–ú–µ—Ö–∞–Ω–∏–∑–º –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:**
```python
# –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ:
1. –¢–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å ‚Üí –≤–µ–∫—Ç–æ—Ä (384D)
2. FAISS –ø–æ–∏—Å–∫ top-k –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø–∏—Å–µ–π
3. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ cosine similarity
4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç LLM
```

**–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:**
```python
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
remember("Flask —Å–µ—Ä–≤–µ—Ä: app.run(host='0.0.0.0', port=5000)")

# –ü–æ–∑–∂–µ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ "–∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å flask"
recall("–∑–∞–ø—É—Å—Ç–∏—Ç—å flask") 
# ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É
# ‚Üí –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç LLM
# ‚Üí –ê–≥–µ–Ω—Ç –∑–Ω–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
```

---

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–º –ø–∞–º—è—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞–º—è—Ç—å –º–æ–∂–µ—Ç —Ä–∞–∑—Ä–∞—Å—Ç–∏—Å—å –¥–æ —Å–æ—Ç–µ–Ω –∑–∞–ø–∏—Å–µ–π, —á—Ç–æ –∑–∞–º–µ–¥–ª—è–µ—Ç –ø–æ–∏—Å–∫.

**–†–µ—à–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö/–Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
1. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (similarity > 0.95)
2. **–õ–∏–º–∏—Ç –ø–æ —Ä–∞–∑–º–µ—Ä—É:** –ú–∞–∫—Å–∏–º—É–º N –∑–∞–ø–∏—Å–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100)
3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏:** "high" —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–æ–ª—å—à–µ

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—á–µ—Ä–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç)
cleanup_memory(scope="project", max_entries=50)

# –ò–ª–∏ —á–µ—Ä–µ–∑ CLI
/memory clear project
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

Context Manager –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

### –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (v2.2.0)

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç v2.1.x:**
- ‚ùå **–ë—ã–ª–æ:** –ñ—ë—Å—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã ‚Üí –¥–æ 25% —Ç–æ–∫–µ–Ω–æ–≤ —Ç–µ—Ä—è–ª–æ—Å—å –∑—Ä—è
- ‚úÖ **–°—Ç–∞–ª–æ:** –ì–∏–±–∫–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã ‚Üí 85-95% —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```python
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö–†–ò–¢–ò–ß–ù–û - –ù–ï –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è):
  ‚îú‚îÄ system_prompt: 10-20% (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)
  ‚îî‚îÄ scratchpad:     5-15% (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–ê–ñ–ù–û - —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è):
  ‚îî‚îÄ L3 memory:     10-30% (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ)

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ì–ò–ë–ö–û - –ø–æ–ª—É—á–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫):
  ‚îî‚îÄ L2 history:    30-70% (–≤—Å—ë –æ—Å—Ç–∞–≤—à–µ–µ—Å—è)

–†–µ–∑–µ—Ä–≤: 5-10% (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è)
```

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–ê–ì 1: –ü–æ–¥—Å—á—ë—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ system_prompt = 1500 —Ç–æ–∫–µ–Ω–æ–≤ (–Ω–µ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è) ‚îÇ
‚îÇ scratchpad    =  800 —Ç–æ–∫–µ–Ω–æ–≤ (–Ω–µ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è) ‚îÇ
‚îÇ –ò–¢–û–ì–û         = 2300 —Ç–æ–∫–µ–Ω–æ–≤ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–ê–ì 2: –†–∞—Å—á—ë—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ max_tokens     = 20480                       ‚îÇ
‚îÇ critical_used  = 2300                        ‚îÇ
‚îÇ reserve        = 1024 (5%)                   ‚îÇ
‚îÇ available      = 20480 - 2300 - 1024 = 17156‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–ê–ì 3: –ü–∞–º—è—Ç—å (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ min_memory = 10% √ó 20480 = 2048              ‚îÇ
‚îÇ max_memory = 30% √ó 20480 = 6144              ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ actual_memory = 1200 —Ç–æ–∫–µ–Ω–æ–≤ (top-3 –∑–∞–ø–∏—Å–∏)  ‚îÇ
‚îÇ ‚Üí –£–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –ª–∏–º–∏—Ç—ã ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º 1200   ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ unused_memory = (6144 - 1200) = 4944 —Ç–æ–∫–µ–Ω–æ–≤ ‚îÇ
‚îÇ ‚Üí –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é! ‚úÖ            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–ê–ì 4: –ò—Å—Ç–æ—Ä–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ min_history = 30% √ó 20480 = 6144             ‚îÇ
‚îÇ max_history = 70% √ó 20480 = 14336            ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ available_for_history = 17156 - 1200 = 15956 ‚îÇ
‚îÇ ‚Üí –ë–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞!                          ‚îÇ
‚îÇ ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∞–∫—Å–∏–º—É–º: 14336 —Ç–æ–∫–µ–Ω–æ–≤         ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ –≠—Ç–æ ~45 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π! üéâ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–ê–ì 5: –†–µ–∑–µ—Ä–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:                                ‚îÇ
‚îÇ   system_prompt: 1500                        ‚îÇ
‚îÇ   scratchpad:     800                        ‚îÇ
‚îÇ   memory:        1200                        ‚îÇ
‚îÇ   history:      14336                        ‚îÇ
‚îÇ   –ò–¢–û–ì–û:        17836 / 20480 (87%)         ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ –†–µ–∑–µ—Ä–≤: 2644 —Ç–æ–∫–µ–Ω–∞ (13%)                    ‚îÇ
‚îÇ –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è: 87% ‚úÖ                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

#### –ü—Ä–∏–º–µ—Ä 1: –ü—É—Å—Ç–∞—è –ø–∞–º—è—Ç—å
```
–°–∏—Ç—É–∞—Ü–∏—è: –ù–æ–≤—ã–π —á–∞—Ç, –ø–∞–º—è—Ç—å L3 –ø—É—Å—Ç–∞—è

–ë–´–õ–û (v2.1.x):
  memory:  0 —Ç–æ–∫–µ–Ω–æ–≤ (–Ω–æ 20% –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ)  ‚Üí 4096 –ü–û–¢–ï–†–Ø–ù–û
  history: 50% = 10240 —Ç–æ–∫–µ–Ω–æ–≤                 ‚Üí –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ

–°–¢–ê–õ–û (v2.2.0):
  memory:  0 —Ç–æ–∫–µ–Ω–æ–≤
  history: 30-70% = –¥–æ 14336 —Ç–æ–∫–µ–Ω–æ–≤ (+40%)    ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!
  
–†–µ–∑—É–ª—å—Ç–∞—Ç: +4096 —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ = ~13 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
```

#### –ü—Ä–∏–º–µ—Ä 2: –ë–æ–ª—å—à–∞—è –ø–∞–º—è—Ç—å
```
–°–∏—Ç—É–∞—Ü–∏—è: –ü—Ä–æ–µ–∫—Ç —Å –±–æ–≥–∞—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π, 50 –∑–∞–ø–∏—Å–µ–π –≤ –ø–∞–º—è—Ç–∏

–ë–´–õ–û (v2.1.x):
  memory:  Top-5 –∑–∞–ø–∏—Å–µ–π (–∂—ë—Å—Ç–∫–æ 20% = 4096 —Ç–æ–∫–µ–Ω–æ–≤)
  history: 50% = 10240 —Ç–æ–∫–µ–Ω–æ–≤

–°–¢–ê–õ–û (v2.2.0):
  memory:  Top-12 –∑–∞–ø–∏—Å–µ–π (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ –¥–æ 30% = 6144 —Ç–æ–∫–µ–Ω–æ–≤)
  history: –û—Å—Ç–∞—Ç–æ–∫ (–º–∏–Ω–∏–º—É–º 30% = 6144 —Ç–æ–∫–µ–Ω–æ–≤)
  
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ë–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è –ø–∞–º—è—Ç—å –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∏—Å—Ç–æ—Ä–∏–∏
```

#### –ü—Ä–∏–º–µ—Ä 3: –û–≥—Ä–æ–º–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è
```
–°–∏—Ç—É–∞—Ü–∏—è: –î–ª–∏—Ç–µ–ª—å–Ω—ã–π –¥–∏–∞–ª–æ–≥, 100+ —Å–æ–æ–±—â–µ–Ω–∏–π

–ë–´–õ–û (v2.1.x):
  history: –û–±—Ä–µ–∑–∞–µ—Ç—Å—è –¥–æ 50% (–≤—Å–µ–≥–¥–∞ ~30 —Å–æ–æ–±—â–µ–Ω–∏–π)

–°–¢–ê–õ–û (v2.2.0):
  history: 30-70% –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–∞–º—è—Ç–∏
  - –ï—Å–ª–∏ –ø–∞–º—è—Ç—å –º–∞–ª–∞ ‚Üí –¥–æ 70% (–¥–æ 50 —Å–æ–æ–±—â–µ–Ω–∏–π)
  - –ï—Å–ª–∏ –ø–∞–º—è—Ç—å –≤–µ–ª–∏–∫–∞ ‚Üí 30% (–Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ ~20 —Å–æ–æ–±—â–µ–Ω–∏–π)
  
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ì–∏–±–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –∑–∞–¥–∞—á—É
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞ `build_context()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

```python
stats = {
    'total_tokens': 17836,
    'max_tokens': 20480,
    'utilization': 0.87,  # 87%
    
    'components': {
        'system_prompt': {'tokens': 1500, 'pct': 0.073},
        'l1_scratchpad': {'tokens': 800, 'pct': 0.039},
        'l3_memory': {'tokens': 1200, 'pct': 0.059, 'k': 3},
        'l2_history': {'tokens': 14336, 'pct': 0.700}
    },
    
    'budget_redistribution': {
        'l3_saved': 4944,      # –ü–∞–º—è—Ç—å —Å—ç–∫–æ–Ω–æ–º–∏–ª–∞
        'l3_to_l2': 4944,      # –ü–µ—Ä–µ—à–ª–æ –≤ –∏—Å—Ç–æ—Ä–∏—é
        'unused_reserve': 2644  # –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑–µ—Ä–≤
    },
    
    'memory_details': {
        'global_entries': 2,    # k –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏
        'project_entries': 1    # k –¥–ª—è –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –ø–∞–º—è—Ç–∏
    }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
```python
# –í –ª–æ–≥–∞—Ö –∞–≥–µ–Ω—Ç–∞
logger.info(f"–£—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞: {stats['utilization']*100:.1f}%")
logger.info(f"–ò—Å—Ç–æ—Ä–∏—è: {stats['components']['l2_history']['tokens']} —Ç–æ–∫–µ–Ω–æ–≤")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
if stats['utilization'] < 0.75:
    logger.warning("–ù–∏–∑–∫–∞—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è! –ü—Ä–æ–≤–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.")
```

---

## API Reference

–ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –∫–ª–∞—Å—Å–∞–º –∏ –º–µ—Ç–æ–¥–∞–º —Å–∏—Å—Ç–µ–º—ã.

### –ö–ª–∞—Å—Å: Agent

**–§–∞–π–ª:** `agent.py`

#### `__init__(model_path: str, chats_dir: str = "chats", **kwargs)`

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞ —Å LLM –º–æ–¥–µ–ª—å—é.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `model_path` (str): –ü—É—Ç—å –∫ GGUF —Ñ–∞–π–ª—É –º–æ–¥–µ–ª–∏
- `chats_dir` (str): –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Ç–æ–≤
- `**kwargs`: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Llama:
  - `n_ctx` (int): –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 20480)
  - `n_gpu_layers` (int): –°–ª–æ–∏ –Ω–∞ GPU (-1 = –≤—Å–µ)
  - `n_threads` (int): –ü–æ—Ç–æ–∫–∏ CPU
  - `flash_attn` (bool): Flash Attention (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: True)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –≠–∫–∑–µ–º–ø–ª—è—Ä Agent

**–ü—Ä–∏–º–µ—Ä:**
```python
agent = Agent(
    model_path="ai/gemma-3n-E4B-it-IQ4_XS.gguf",
    chats_dir="chats",
    n_ctx=20480,
    n_gpu_layers=-1,
    flash_attn=True
)
```

---

#### `run_cycle(user_input: str) -> Generator`

–ó–∞–ø—É—Å–∫ ReAct —Ü–∏–∫–ª–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_input` (str): –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- Generator, –∫–æ—Ç–æ—Ä—ã–π yield'–∏—Ç —Å–ª–æ–≤–∞—Ä–∏:
  ```python
  {
      "thought": "–†–∞–∑–º—ã—à–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞",
      "action": {
          "tool_name": "–∏–º—è_–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞",
          "parameters": {"param": "value"}
      }
  }
  ```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
gen = agent.run_cycle("–°–æ–∑–¥–∞–π —Ñ–∞–π–ª hello.py")

for step in gen:
    print(f"Thought: {step['thought']}")
    print(f"Action: {step['action']}")
    
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∏–≥–Ω–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    if user_approves(step):
        result = gen.send(True)  # True = –≤—ã–ø–æ–ª–Ω–∏—Ç—å
    else:
        result = gen.send(False)  # False = –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ú–∞–∫—Å–∏–º—É–º 10 —Ü–∏–∫–ª–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- Retry –¥–æ 5 —Ä–∞–∑ –ø—Ä–∏ JSON –æ—à–∏–±–∫–∞—Ö
- Self-Reflection –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

---

#### `new_chat(chat_name: str, description: str = "") -> str`

–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chat_name` (str): –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è
- `description` (str): –û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ

**–ü—Ä–∏–º–µ—Ä:**
```python
agent.new_chat("web_project", "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è")
# ‚Üí "‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —á–∞—Ç: web_project"
```

---

#### `switch_chat(chat_name: str) -> str`

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —á–∞—Ç.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chat_name` (str): –ò–º—è —á–∞—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ

**–ü—Ä–∏–º–µ—Ä:**
```python
agent.switch_chat("web_project")
# ‚Üí "üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ —á–∞—Ç: web_project"
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ï—Å–ª–∏ —á–∞—Ç –≤ –ø–∞–º—è—Ç–∏ ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
- –ï—Å–ª–∏ —á–∞—Ç –Ω–∞ –¥–∏—Å–∫–µ ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ + –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
- –ï—Å–ª–∏ —á–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –æ—à–∏–±–∫–∞

---

#### `save_current_chat(description: str = "") -> str`

–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞ –Ω–∞ –¥–∏—Å–∫.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `description` (str): –û–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –ü—É—Ç—å –∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–º—É —á–∞—Ç—É

**–ü—Ä–∏–º–µ—Ä:**
```python
agent.save_current_chat("–î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è")
# ‚Üí "üíæ –ß–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω: chats/web_project/"
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```
chats/web_project/
‚îú‚îÄ‚îÄ metadata.json       # –ò–º—è, –æ–ø–∏—Å–∞–Ω–∏–µ, –¥–∞—Ç–∞
‚îú‚îÄ‚îÄ history.json        # –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞
‚îú‚îÄ‚îÄ scratchpad.json     # –¢–µ–∫—É—â–∏–π scratchpad
‚îî‚îÄ‚îÄ memory/             # –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –ø–∞–º—è—Ç—å
    ‚îú‚îÄ‚îÄ index.faiss
    ‚îî‚îÄ‚îÄ storage.json
```

---

#### `load_chat(chat_name: str) -> str`

–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞ —Å –¥–∏—Å–∫–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chat_name` (str): –ò–º—è —á–∞—Ç–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ

**–ü—Ä–∏–º–µ—Ä:**
```python
agent.load_chat("web_project")
# ‚Üí "üìÇ –ß–∞—Ç –∑–∞–≥—Ä—É–∂–µ–Ω: web_project"
```

---

### –ö–ª–∞—Å—Å: MemoryManager

**–§–∞–π–ª:** `memory.py`

#### `add_memory(content: str, importance: str = "medium", scope: str = "global")`

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ø–∞–º—è—Ç—å.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `content` (str): –¢–µ–∫—Å—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- `importance` (str): "low" | "medium" | "high"
- `scope` (str): "global" | "project"

**–ü—Ä–∏–º–µ—Ä:**
```python
memory_manager.add_memory(
    "API –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ .env —Ñ–∞–π–ª–µ",
    importance="high",
    scope="project"
)
```

---

#### `search(query: str, k: int = 5, scope: str = "both") -> List[Dict]`

–ü–æ–∏—Å–∫ –≤ –ø–∞–º—è—Ç–∏ –ø–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–º—É —Å—Ö–æ–¥—Å—Ç–≤—É.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (str): –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `k` (int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `scope` (str): "global" | "project" | "both"

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```python
[
    {
        "content": "API –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ .env —Ñ–∞–π–ª–µ",
        "similarity": 0.89,
        "importance": "high",
        "scope": "project"
    },
    ...
]
```

---

### –ö–ª–∞—Å—Å: ContextManager

**–§–∞–π–ª:** `context_manager.py`

#### `build_context(system_prompt: str, scratchpad: Dict, history: List, current_query: str) -> Tuple`

–°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `system_prompt` (str): –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- `scratchpad` (Dict): –†–∞–±–æ—á–∞—è –ø–∞–º—è—Ç—å
- `history` (List): –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞
- `current_query` (str): –¢–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```python
(
    context_string,    # –°–æ–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    statistics,        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    enhanced_prompt    # –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç
)
```

**–ü—Ä–∏–º–µ—Ä:**
```python
context, stats, prompt = context_manager.build_context(
    system_prompt="–¢—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç...",
    scratchpad={"goal": "–°–æ–∑–¥–∞—Ç—å API"},
    history=[...],
    current_query="–î–æ–±–∞–≤—å —ç–Ω–¥–ø–æ–∏–Ω—Ç /users"
)

print(f"–£—Ç–∏–ª–∏–∑–∞—Ü–∏—è: {stats['utilization']*100:.1f}%")
```

---

### –ö–ª–∞—Å—Å: ChatManager

**–§–∞–π–ª:** `chat_manager.py`

#### `create_chat(chat_name: str, description: str = "") -> bool`

–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞.

#### `get_chat(chat_name: str) -> Dict`

–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–∞—Ç–∞.

#### `save_chat(chat_name: str, data: Dict) -> str`

–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–∞ –Ω–∞ –¥–∏—Å–∫.

#### `load_chat(chat_name: str) -> Dict`

–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞ —Å –¥–∏—Å–∫–∞.

#### `list_chats() -> List[str]`

–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ (–≤ –ø–∞–º—è—Ç–∏ + –Ω–∞ –¥–∏—Å–∫–µ).

---

## Troubleshooting

–†–µ—à–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –∏ –æ—à–∏–±–æ–∫.

### JSON –ø–∞—Ä—Å–∏–Ω–≥

#### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid \escape" –∏–ª–∏ "JSONDecodeError"

**–°–∏–º–ø—Ç–æ–º—ã:**
```
ERROR - –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: Invalid \escape: line 1 column 694
ERROR - –ù–µ–ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON: thought=False, action=False
```

**–ü—Ä–∏—á–∏–Ω–∞:**
Gemma –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Python-–∫–æ–¥ —Å escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã –≤ JSON:
- –í–∞–ª–∏–¥–Ω—ã–µ JSON escapes: `\"`, `\\`, `\/`, `\b`, `\f`, `\n`, `\r`, `\t`, `\uXXXX`
- Gemma –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç: `\'`, `\.`, `\?`, `\+`, `\*`, `\[`, `\]` (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ!)

**–†–µ—à–µ–Ω–∏–µ (v2.1.2):**
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–≤—É—Ö—à–∞–≥–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π:

```python
# –®–∞–≥ 1: –£–¥–≤–æ–∏—Ç—å –≤—Å–µ –ø–∞—Ä—ã backslash
content = content.replace('\\\\', '\\\\\\\\')

# –®–∞–≥ 2: –£–¥–∞–ª–∏—Ç—å backslash –ø–µ—Ä–µ–¥ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏
content = re.sub(r'\\(?!["\\/bfnrtu])', '', content)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
python tests/test_hotfix_v2.1.2.py

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 2/2 tests passed
```

---

#### –ü—Ä–æ–±–ª–µ–º–∞: "Expecting ',' delimiter"

**–°–∏–º–ø—Ç–æ–º—ã:**
```
JSONDecodeError: Expecting ',' delimiter: line 1 column 320
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–¢—Ä–æ–π–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–≤—ã—á–µ–∫: `\\\"` –≤–º–µ—Å—Ç–æ `\"`

**–ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```python
cleaned = raw.replace('\\\\', '\\')  # \\\" ‚Üí \" (–ª–æ–º–∞–µ—Ç JSON!)
```

**–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```python
# –°–Ω–∞—á–∞–ª–∞ —Ñ–∏–∫—Å–∏–º —Ç—Ä–æ–π–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
cleaned = raw.replace('\\\\\"', '\\"')
# –ó–∞—Ç–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–≤–æ–π–Ω—ã–µ —Å–ª–µ—à–∏
cleaned = cleaned.replace('\\\\', '\\')
```

---

### –ü—É—Ç–∏ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

#### –ü—Ä–æ–±–ª–µ–º–∞: logs/, chats/, memory/ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ CWD

**–°–∏–º–ø—Ç–æ–º—ã:**
```bash
$ cd /home/vova/testsand
$ python ../AI/cli.py
$ ls
logs/  chats/  memory/  # ‚Üê –°–æ–∑–¥–∞–Ω—ã –∑–¥–µ—Å—å, –∞ –Ω–µ –≤ /home/vova/AI!
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Path.cwd()` –≤–º–µ—Å—Ç–æ `Path(__file__).parent`

**–†–µ—à–µ–Ω–∏–µ (v2.1.2):**
```python
# agent.py, __init__
# –ë–´–õ–û:
self.project_root = Path.cwd().resolve()  # ‚ùå CWD

# –°–¢–ê–õ–û:
self.project_root = Path(__file__).parent.resolve()  # ‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è agent.py
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
cd /tmp
python /home/vova/AI/cli.py

# –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# INFO - –ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞: /home/vova/AI
```

---

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è 6+ —Å–µ–∫—É–Ω–¥

**–°–∏–º–ø—Ç–æ–º—ã:**
```
INFO - –ò–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤...
(6 —Å–µ–∫—É–Ω–¥ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ huggingface.co)
```

**–ü—Ä–∏—á–∏–Ω–∞:**
`SentenceTransformer(model_name)` –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç HuggingFace API

**–†–µ—à–µ–Ω–∏–µ (v2.1.2):**
```python
# memory.py, EmbeddingModelSingleton
try:
    cls._model = SentenceTransformer(model_name, local_files_only=True)
    logger.info("–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∞")
except:
    cls._model = SentenceTransformer(model_name, local_files_only=False)
    logger.info("–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫: ~6 —Å–µ–∫ (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ: <1 —Å–µ–∫ (–ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à `~/.cache/huggingface/`)

---

#### –ü—Ä–æ–±–ª–µ–º–∞: CUDA Out of Memory

**–°–∏–º–ø—Ç–æ–º—ã:**
```
RuntimeError: CUDA out of memory
```

**–†–µ—à–µ–Ω–∏–µ 1: –£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç**
```python
agent = Agent(
    model_path="...",
    n_ctx=16384  # –í–º–µ—Å—Ç–æ 20480
)
```

**–†–µ—à–µ–Ω–∏–µ 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ KV-–∫—ç—à–∞ –≤ VRAM**
```python
# –í v3.3.1+: KV-–∫—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤ VRAM –ø—Ä–∏ n_gpu_layers=-1
# –ù–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å type_k/type_v –∏–ª–∏ cache_type_k/cache_type_v
# llama-cpp-python –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
```

**–†–µ—à–µ–Ω–∏–µ 3: –£–º–µ–Ω—å—à–∏—Ç—å n_gpu_layers**
```python
agent = Agent(
    model_path="...",
    n_gpu_layers=30  # –í–º–µ—Å—Ç–æ -1 (–≤—Å–µ —Å–ª–æ–∏)
)
```

---

### –ü–∞–º—è—Ç—å –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç

#### –ü—Ä–æ–±–ª–µ–º–∞: –ü–∞–º—è—Ç—å —Ä–∞–∑—Ä–æ—Å–ª–∞—Å—å –¥–æ 500+ –∑–∞–ø–∏—Å–µ–π

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ú–µ–¥–ª–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –≤ –ø–∞–º—è—Ç–∏
- –ù–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
cleanup_memory(scope="project", max_entries=100)

# –ò–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
deduplicate_memory(threshold=0.95)
```

---

#### –ü—Ä–æ–±–ª–µ–º–∞: –ò—Å—Ç–æ—Ä–∏—è –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ

**–°–∏–º–ø—Ç–æ–º—ã:**
–ê–≥–µ–Ω—Ç "–∑–∞–±—ã–≤–∞–µ—Ç" —á—Ç–æ –±—ã–ª–æ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞–∑–∞–¥

**–ü—Ä–∏—á–∏–Ω–∞:**
–ü–∞–º—è—Ç—å L3 –∑–∞–Ω–∏–º–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –£–º–µ–Ω—å—à–∏—Ç—å k –¥–ª—è –ø–∞–º—è—Ç–∏ –≤ context_manager.py
'l3_memory': {
    'priority': 2,
    'min': 0.10,
    'max': 0.20  # –ë—ã–ª–æ 0.30, —Å—Ç–∞–ª–æ 0.20
}
```

---

### LLM –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

#### –ü—Ä–æ–±–ª–µ–º–∞: –ê–≥–µ–Ω—Ç –∑–∞—Ü–∏–∫–ª–∏–≤–∞–µ—Ç—Å—è (10/10 —Ü–∏–∫–ª–æ–≤)

**–°–∏–º–ø—Ç–æ–º—ã:**
```
WARNING - –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Ü–∏–∫–ª–æ–≤ (10)
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏
- –û—à–∏–±–∫–∏ –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- –°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –†–∞–∑–±–∏—Ç—å –∑–∞–¥–∞—á—É –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `logs/agent_<date>.log`
3. –î–æ–±–∞–≤–∏—Ç—å Self-Reflection (—É–∂–µ –µ—Å—Ç—å –≤ v2.1.0+)

---

#### –ü—Ä–æ–±–ª–µ–º–∞: Gemma –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON

**–°–∏–º–ø—Ç–æ–º—ã:**
```
ERROR - –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –ø–æ–ø—ã—Ç–∫–∞ 1/5
ERROR - –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –ø–æ–ø—ã—Ç–∫–∞ 2/5
...
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –ø—Ä–æ–º–ø—Ç–µ
- Temperature —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞—è

**–†–µ—à–µ–Ω–∏–µ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç**
–£–±–µ–¥–∏—Å—å —á—Ç–æ –≤ `agent.py` –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä—ã JSON:
```python
system_prompt = """
...
–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (—Å—Ç—Ä–æ–≥–æ JSON):
{
    "thought": "–ú—ã—Å–ª—å",
    "action": {
        "tool_name": "–Ω–∞–∑–≤–∞–Ω–∏–µ",
        "parameters": {"key": "value"}
    }
}
"""
```

**–†–µ—à–µ–Ω–∏–µ 2: –£–º–µ–Ω—å—à–∏—Ç—å temperature**
```python
# agent.py, –º–µ—Ç–æ–¥ _generate_response
response = self.llm.create_completion(
    messages=...,
    temperature=0.4,  # –ë—ã–ª–æ 0.7, —Å—Ç–∞–ª–æ 0.4
    ...
)
```

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### v2.2.0 - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π Context Manager (2025-01-09)

#### üöÄ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º** —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: system_prompt + scratchpad (–ù–ï –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è)
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: L3 –ø–∞–º—è—Ç—å (10-30%, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ)
  - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: L2 –∏—Å—Ç–æ—Ä–∏—è (30-70%, –ø–æ–ª—É—á–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫)
  - **–£—Ç–∏–ª–∏–∑–∞—Ü–∏—è:** 85-95% (–±—ã–ª–æ ~75%)

#### üìä –£–ª—É—á—à–µ–Ω–∏—è
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π k –¥–ª—è –ø–∞–º—è—Ç–∏:
  - –ì–ª–æ–±–∞–ª—å–Ω–∞—è: k=2‚Üí5 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞)
  - –ü—Ä–æ–µ–∫—Ç–Ω–∞—è: k=3‚Üí7 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞)
- –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ `build_context()`

#### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `IMPLEMENTATION_v2.2.0.md` - –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- `QUICK_REFERENCE_v2.2.0.md` - –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞
- `ADAPTIVE_CONTEXT_MANAGER.md` - –û–ø–∏—Å–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞

---

### v2.1.2 - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2025-01-09)

#### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
1. **JSON –ø–∞—Ä—Å–∏–Ω–≥ –ø–∞–¥–∞–ª –Ω–∞ escape-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è—Ö**
   - –ü—Ä–æ–±–ª–µ–º–∞: Gemma –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ JSON escapes (`\'`, `\.`, `\?`)
   - –†–µ—à–µ–Ω–∏–µ: –î–≤—É—Ö—à–∞–≥–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞
     - –®–∞–≥ 1: `\\` ‚Üí `\\\\` (—É–¥–≤–æ–µ–Ω–∏–µ backslash)
     - –®–∞–≥ 2: –£–¥–∞–ª–µ–Ω–∏–µ `\X` –≥–¥–µ X –Ω–µ –≤ `["\\/bfnrtu]`
   - –§–∞–π–ª: `agent.py`, —Å—Ç—Ä–æ–∫–∏ 201-227

2. **–î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –≤ CWD –≤–º–µ—Å—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∞–≥–µ–Ω—Ç–∞**
   - –ü—Ä–æ–±–ª–µ–º–∞: `Path.cwd()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
   - –†–µ—à–µ–Ω–∏–µ: `Path(__file__).parent` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è agent.py
   - –§–∞–π–ª: `agent.py`, —Å—Ç—Ä–æ–∫–∏ 20-25

3. **–ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∑–∞–≥—Ä—É–∂–∞–ª–∞—Å—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ (~6 —Å–µ–∫)**
   - –ü—Ä–æ–±–ª–µ–º–∞: SentenceTransformer –ø—Ä–æ–≤–µ—Ä—è–µ—Ç HuggingFace API
   - –†–µ—à–µ–Ω–∏–µ: `local_files_only=True` —Å fallback
   - –§–∞–π–ª: `memory.py`, —Å—Ç—Ä–æ–∫–∏ 22-36
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: <1 —Å–µ–∫ –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö

#### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `HOTFIX_v2.1.2_FINAL.md` - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- `tests/test_hotfix_v2.1.2.py` - Unit-—Ç–µ—Å—Ç—ã (2/2 passed)

---

### v2.1.1 - JSON –ø–∞—Ä—Å–∏–Ω–≥ (2025-10-09)

#### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **JSON –ø–∞—Ä—Å–∏–Ω–≥ –ø–∞–¥–∞–ª –Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ >2 —É—Ä–æ–≤–Ω–µ–π**
  - –ü—Ä–æ–±–ª–µ–º–∞: Regex –Ω–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–ª –≥–ª—É–±–æ–∫—É—é –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å
  - –†–µ—à–µ–Ω–∏–µ: –ê–ª–≥–æ—Ä–∏—Ç–º —Å –±–∞–ª–∞–Ω—Å–æ–º —Å–∫–æ–±–æ–∫
  - –§–∞–π–ª: `agent.py`, —Å—Ç—Ä–æ–∫–∏ 220-237

---

### v2.1.0 - –ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (2025-10-09)

#### üöÄ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è VRAM**
   - n_ctx: 16384 ‚Üí **20480** (+25%)
   - Flash Attention –≤–∫–ª—é—á—ë–Ω (—ç–∫–æ–Ω–æ–º–∏—è 20-30% VRAM)
   - KV-–∫—ç—à FP16 (—ç–∫–æ–Ω–æ–º–∏—è ~30% –ø–∞–º—è—Ç–∏)
   - –§–∞–π–ª: `agent.py`, —Å—Ç—Ä–æ–∫–∏ 50-62

2. **–ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–¥–æ–º**
   - `analyze_code(file_path)` - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ Python —á–µ—Ä–µ–∑ AST
     - –°–ø–∏—Å–æ–∫ –∏–º–ø–æ—Ä—Ç–æ–≤, –∫–ª–∞—Å—Å–æ–≤, —Ñ—É–Ω–∫—Ü–∏–π —Å –Ω–æ–º–µ—Ä–∞–º–∏ —Å—Ç—Ä–æ–∫
     - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
     - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞
   - `edit_file_at_line(file_path, start, end, content)` - –¢–æ—á–µ—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
     - –ó–∞–º–µ–Ω–∞/–≤—Å—Ç–∞–≤–∫–∞/—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ –Ω–æ–º–µ—Ä–∞–º —Å—Ç—Ä–æ–∫
     - –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏—è —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞
   - –§–∞–π–ª: `tools.py`, —Å—Ç—Ä–æ–∫–∏ 250-360

3. **Self-Reflection –≤ ReAct**
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–∏—á–∏–Ω—É
   - –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - –ê–≥–µ–Ω—Ç –≤–∏–¥–∏—Ç –∞–Ω–∞–ª–∏–∑ –≤ Observation –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –µ—Å–ª–∏ cycles > 1
   - –§–∞–π–ª: `agent.py`, —Å—Ç—Ä–æ–∫–∏ 303-338

#### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `chat_manager.py`: –ù–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π except –±–ª–æ–∫ (—Å—Ç—Ä–æ–∫–∞ 171)
- `cli.py`: –ö–æ–º–∞–Ω–¥–∞ cd –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- `agent.py`: –£–±—Ä–∞–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è –æ–±—Ä–µ–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏

#### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **25/25 unit-—Ç–µ—Å—Ç–æ–≤ passed** (100% success rate)
- –î–æ–±–∞–≤–ª–µ–Ω–æ 8 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

#### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `CHANGELOG.md` - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `NEW_TOOLS_GUIDE.md` - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–æ–≤—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º
- `RELEASE_NOTES_v2.1.0.md` - –°–≤–æ–¥–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

### v2.0.1 - –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è (2025-10-07)

#### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –£–ª—É—á—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ø–∞–º—è—Ç–∏
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–µ–ª–∫–∏–µ –±–∞–≥–∏ –≤ CLI

---

### v2.0.0 - –ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑ (2025-10-01)

#### üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ReAct –∞–≥–µ–Ω—Ç –Ω–∞ –±–∞–∑–µ Gemma-3n
- –¢—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏ (L1/L2/L3)
- –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ø–∞–º—è—Ç—å (FAISS + SentenceTransformer)
- –°–∏—Å—Ç–µ–º–∞ —á–∞—Ç–æ–≤ —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π TUI (Rich + Prompt Toolkit)
- –ù–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è LLM

**–§–∞–π–ª:** `agent.py`, —Å—Ç—Ä–æ–∫–∏ 50-62

```python
self.llm = Llama(
    model_path=model_path,
    n_ctx=24576,           # –ö–æ–Ω—Ç–µ–∫—Å—Ç 24k —Ç–æ–∫–µ–Ω–æ–≤ (v3.3.1+)
    n_threads=8,           # CPU –ø–æ—Ç–æ–∫–∏
    n_gpu_layers=-1,       # –í—Å–µ —Å–ª–æ–∏ –Ω–∞ GPU (KV-–∫—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ VRAM)
    verbose=False,
    flash_attn=True,       # Flash Attention –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ VRAM
    chat_format="gemma"
)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

**–§–∞–π–ª:** `agent.py`, –º–µ—Ç–æ–¥ `_build_system_prompt()`

```python
system_prompt = f"""
–¢—ã –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π AI-–∞–≥–µ–Ω—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º.

–†–ï–ñ–ò–ú –†–ê–ë–û–¢–´: ReAct (Reason ‚Üí Action ‚Üí Observation)

–î–û–°–¢–£–ü–ù–´–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–´:
{tools_description}

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (—Å—Ç—Ä–æ–≥–æ JSON):
{{
    "thought": "–¢–≤–æ—ë —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–µ –æ –∑–∞–¥–∞—á–µ",
    "action": {{
        "tool_name": "–Ω–∞–∑–≤–∞–Ω–∏–µ_–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞",
        "parameters": {{"param": "value"}}
    }}
}}

–ü–†–ê–í–ò–õ–ê:
1. –í–°–ï–ì–î–ê –æ—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–º JSON
2. –ò—Å–ø–æ–ª—å–∑—É–π tool_name="finish" –∫–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
3. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏ –∏—Å–ø—Ä–∞–≤—å –ø–æ–¥—Ö–æ–¥
4. –ù–µ –≤—ã–¥—É–º—ã–≤–∞–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –∏–∑ —Å–ø–∏—Å–∫–∞

–ü–†–ò–ú–ï–†–´:
... (–ø—Ä–∏–º–µ—Ä—ã JSON –æ—Ç–≤–µ—Ç–æ–≤) ...
"""
```

### –§–æ—Ä–º–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Ç–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** `chats/<chat_name>/`

#### `metadata.json`
```json
{
    "name": "web_project",
    "description": "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",
    "created_at": "2025-01-09T10:30:00",
    "updated_at": "2025-01-09T15:45:00"
}
```

#### `history.json`
```json
[
    {
        "role": "user",
        "content": "–°–æ–∑–¥–∞–π —Ñ–∞–π–ª app.py",
        "timestamp": "2025-01-09T10:31:00"
    },
    {
        "role": "assistant",
        "content": "{\"thought\": \"...\", \"action\": {...}}",
        "timestamp": "2025-01-09T10:31:05"
    }
]
```

#### `scratchpad.json`
```json
{
    "goal": "–°–æ–∑–¥–∞—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Flask",
    "plan": [
        "1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Flask",
        "2. –°–æ–∑–¥–∞—Ç—å app.py",
        "3. –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç—ã"
    ],
    "completed": ["1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Flask"],
    "current_step": "2. –°–æ–∑–¥–∞—Ç—å app.py"
}
```

#### `memory/` 
–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ø–∞–º—è—Ç—å (FAISS + storage.json)

---

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–§–∞–π–ª:** `requirements.txt`

```
llama-cpp-python>=0.2.0    # LLM
faiss-cpu>=1.7.4           # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î
sentence-transformers>=2.2 # –≠–º–±–µ–¥–¥–∏–Ω–≥–∏
rich>=13.0                 # UI
prompt-toolkit>=3.0        # –í–≤–æ–¥
requests>=2.31             # HTTP
beautifulsoup4>=4.12       # –ü–∞—Ä—Å–∏–Ω–≥ HTML
python-dotenv>=1.0         # .env
pytest>=7.4                # –¢–µ—Å—Ç—ã
```

---

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:**
- Python 3.11+
- 16 –ì–ë RAM
- 8 –ì–ë VRAM (–¥–ª—è GPU) –∏–ª–∏ –º–æ—â–Ω—ã–π CPU
- 10 –ì–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (–º–æ–¥–µ–ª—å + –∫—ç—à–∏)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:**
- Python 3.11+
- 32 –ì–ë RAM
- 12+ –ì–ë VRAM (NVIDIA GPU —Å CUDA)
- 20 –ì–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- SSD –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ FAISS

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–ê–≤—Ç–æ—Ä:** vova  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 1.0  
**–î–∞—Ç–∞:** 09.01.2025

**–ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å:**
- –õ–æ–≥–∏: `logs/agent_<date>.log`
- –¢–µ—Å—Ç—ã: `pytest tests/`
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `doc/MASTER_DOCUMENTATION.md`

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**
