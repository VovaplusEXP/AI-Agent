# Enhanced CLI - Улучшенный интерфейс командной строки

## Обзор

Enhanced CLI - это улучшенная версия интерфейса командной строки для AI Agent, вдохновленная дизайном [google-gemini/gemini-cli](https://github.com/google-gemini/gemini-cli).

## ✨ Новые возможности

### 1. 📊 Статус-панель в реальном времени

Отображает:
- **Текущий чат**: Имя активного чата
- **Использование контекста**: Процент свободного контекста и количество токенов
  - 🟢 Зеленый (>50% свободно)
  - 🟡 Желтый (20-50% свободно)
  - 🔴 Красный (<20% свободно)
- **Использование памяти**: Текущее потребление RAM процессом
  - 🟢 Зеленый (<1 GB)
  - 🟡 Желтый (1-2 GB)
  - 🔴 Красный (>2 GB)

### 2. 🎨 Улучшенное визуальное оформление

- Красивый экран приветствия с ASCII-артом
- Панели с закругленными границами (rounded box)
- Цветовое кодирование для различных типов сообщений
- Иконки для различных типов действий (💭 мысль, 🔧 действие, ✓ успех, ✗ ошибка)

### 3. 📝 Предпросмотр кода

При операциях с файлами (`write_file`, `create_file`) CLI показывает:
- Путь к файлу
- Количество строк
- Подсветку синтаксиса кода
- Возможность изменить путь перед сохранением

Пример:
```
╭─────────────── Code Preview ───────────────╮
│ File: hello.py                             │
│ Lines: 10                                  │
│                                            │
│  1 def greet(name):                        │
│  2     print(f"Hello, {name}!")            │
│  3                                         │
│  4 if __name__ == "__main__":              │
│  5     greet("World")                      │
╰────────────────────────────────────────────╯

Write this file? ([Y]es/[N]o/[E]dit path) 
```

### 4. 📖 Улучшенный рендеринг Markdown

- Используется Rich Markdown для красивого отображения
- Поддержка всех элементов Markdown (заголовки, списки, блоки кода, и т.д.)
- Автоматическая подсветка синтаксиса в блоках кода

### 5. 🎯 Новые команды

**`/status`** - Быстрый просмотр детального статуса системы

**`/stats`** - Статистика сессии и использования инструментов:
- Длительность сессии
- Текущий чат
- Использование контекста и памяти
- Статистика вызовов инструментов (количество, success rate, среднее время)

### 6. ⏱️ Анимированные индикаторы

- **Spinner** при ожидании ответа агента ("Agent thinking...")
- **Spinner** при выполнении инструментов ("Executing tool_name...")
- Визуальная обратная связь о процессе выполнения

## 🚀 Использование

### Запуск Enhanced CLI

```bash
python enhanced_cli.py
```

### Основные команды

#### Управление чатами
- `/new <name> [description]` - Создать новый чат
- `/switch <name>` - Переключиться на чат
- `/list` - Показать активные чаты

#### Сохранение и загрузка
- `/save [description]` - Сохранить текущий чат
- `/load <name>` - Загрузить чат с диска
- `/saved` - Показать сохраненные чаты
- `/delete <name>` - Удалить сохраненный чат

#### Память и статистика
- `/memory` - Показать статистику памяти
- `/status` - Показать детальный статус
- `/stats` - Показать статистику сессии и инструментов

#### Прочее
- `/help` - Показать справку
- `Ctrl+O` - Переключить режим чат/оболочка
- `exit` или `quit` - Выход из программы

## 📦 Зависимости

Enhanced CLI требует следующих новых зависимостей:

```
psutil>=5.9.0  # Для мониторинга памяти
```

Все остальные зависимости уже присутствуют в проекте (rich, prompt-toolkit).

## 🔧 Установка

1. Убедитесь, что вы находитесь в ветке `cli-test`:
   ```bash
   git checkout cli-test
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Запустите Enhanced CLI:
   ```bash
   python enhanced_cli.py
   ```

## 🎨 Кастомизация

### Изменение цветов

Цвета определяются в коде и могут быть легко настроены. Основные цвета:
- **cyan** - Основной акцентный цвет для панелей и заголовков
- **green** - Успешные операции и здоровые показатели
- **yellow** - Предупреждения и средние показатели
- **red** - Ошибки и критические показатели

### Настройка статус-панели

Пороговые значения для цветовых индикаторов можно изменить в классе `EnhancedStatusBar`:

```python
# Контекст
if free_percent > 50:
    context_color = "green"
elif free_percent > 20:
    context_color = "yellow"
else:
    context_color = "red"

# Память
if mem_mb < 1024:
    mem_color = "green"
elif mem_mb < 2048:
    mem_color = "yellow"
else:
    mem_color = "red"
```

## 🔄 Отличия от оригинального CLI

| Функция | Оригинальный CLI | Enhanced CLI |
|---------|------------------|--------------|
| Статус-панель | Нет | ✓ Да, в реальном времени |
| Предпросмотр кода | Нет | ✓ Да, с подсветкой |
| Контекст-трекер | Нет | ✓ Да, % свободного |
| Мониторинг памяти | Нет | ✓ Да, RSS memory |
| Markdown | Базовый | ✓ Rich Markdown |
| Визуальное оформление | Простое | ✓ Панели с иконками |

## 🐛 Известные ограничения

1. **Производительность**: Обновление статус-панели может замедлить работу на очень медленных системах
2. **Размер терминала**: Для лучшего отображения рекомендуется терминал шириной минимум 80 символов
3. **Цвета**: Некоторые терминалы могут не поддерживать все цвета

## 📝 Новое в v0.0.3-alpha

- ✅ **Статистика инструментов** - отслеживание вызовов, success rate и времени выполнения
- ✅ **Анимированные spinners** - visual feedback при работе агента
- ✅ **Команда /stats** - детальная статистика сессии
- ✅ **Отслеживание времени сессии** - видно сколько времени работаете с агентом
- ✅ **Улучшенная визуальная обратная связь** - понятно что происходит в каждый момент

## 🔮 Планы на будущее

- [ ] Поддержка тем (темная/светлая)
- [ ] Настраиваемые пороговые значения через конфиг
- [ ] График использования контекста в реальном времени
- [ ] История команд с поиском
- [ ] Экспорт сессии в Markdown/HTML

## 📄 Лицензия

Enhanced CLI является частью проекта AI Agent и распространяется под той же лицензией (AGPL-3.0).

## 🙏 Благодарности

- **google-gemini/gemini-cli** - Вдохновение для дизайна интерфейса
- **Rich** - Отличная библиотека для красивых CLI
- **prompt-toolkit** - Мощный инструмент для интерактивных CLI

---

**Версия**: 1.0.0-alpha  
**Дата**: 2025-10-18  
**Статус**: Экспериментальный (ветка cli-test)
